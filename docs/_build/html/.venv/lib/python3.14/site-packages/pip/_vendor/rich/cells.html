

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ranges of unicode ordinals that produce a 1-cell wide character &mdash; Retrogue 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/custom.css?v=a6a68382" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/fonts.css?v=5583d106" />

  
      <script src="../../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../../index.html" class="icon icon-home">
            Retrogue
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../index.html">Retrogue</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Ranges of unicode ordinals that produce a 1-cell wide character</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../../_sources/.venv/lib/python3.14/site-packages/pip/_vendor/rich/cells.py.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>from <strong>future</strong> import annotations</p>
<p>from functools import lru_cache
from typing import Callable</p>
<p>from ._cell_widths import CELL_WIDTHS</p>
<section id="ranges-of-unicode-ordinals-that-produce-a-1-cell-wide-character">
<h1>Ranges of unicode ordinals that produce a 1-cell wide character<a class="headerlink" href="#ranges-of-unicode-ordinals-that-produce-a-1-cell-wide-character" title="Link to this heading">ïƒ</a></h1>
</section>
<section id="this-is-non-exhaustive-but-covers-most-common-western-characters">
<h1>This is non-exhaustive, but covers most common Western characters<a class="headerlink" href="#this-is-non-exhaustive-but-covers-most-common-western-characters" title="Link to this heading">ïƒ</a></h1>
<p>_SINGLE_CELL_UNICODE_RANGES: list[tuple[int, int]] = [
(0x20, 0x7E),  # Latin (excluding non-printable)
(0xA0, 0xAC),
(0xAE, 0x002FF),
(0x00370, 0x00482),  # Greek / Cyrillic
(0x02500, 0x025FC),  # Box drawing, box elements, geometric shapes
(0x02800, 0x028FF),  # Braille
]</p>
</section>
<section id="a-set-of-characters-that-are-a-single-cell-wide">
<h1>A set of characters that are a single cell wide<a class="headerlink" href="#a-set-of-characters-that-are-a-single-cell-wide" title="Link to this heading">ïƒ</a></h1>
<p>_SINGLE_CELLS = frozenset(
[
character
for _start, _end in _SINGLE_CELL_UNICODE_RANGES
for character in map(chr, range(_start, _end + 1))
]
)</p>
</section>
<section id="when-called-with-a-string-this-will-return-true-if-all">
<h1>When called with a string this will return True if all<a class="headerlink" href="#when-called-with-a-string-this-will-return-true-if-all" title="Link to this heading">ïƒ</a></h1>
</section>
<section id="characters-are-single-cell-otherwise-false">
<h1>characters are single-cell, otherwise False<a class="headerlink" href="#characters-are-single-cell-otherwise-false" title="Link to this heading">ïƒ</a></h1>
<p>_is_single_cell_widths: Callable[[str], bool] = _SINGLE_CELLS.issuperset</p>
<p>&#64;lru_cache(4096)
def cached_cell_len(text: str) -&gt; int:
â€œâ€â€Get the number of cells required to display text.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>This method always caches, which may use up a lot of memory. It is recommended to use
`cell_len` over this method.

Args:
    text (str): Text to display.

Returns:
    int: Get the number of cells required to display text.
&quot;&quot;&quot;
if _is_single_cell_widths(text):
    return len(text)
return sum(map(get_character_cell_size, text))
</pre></div>
</div>
<p>def cell_len(text: str, _cell_len: Callable[[str], int] = cached_cell_len) -&gt; int:
â€œâ€â€Get the number of cells required to display text.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Args:
    text (str): Text to display.

Returns:
    int: Get the number of cells required to display text.
&quot;&quot;&quot;
if len(text) &lt; 512:
    return _cell_len(text)
if _is_single_cell_widths(text):
    return len(text)
return sum(map(get_character_cell_size, text))
</pre></div>
</div>
<p>&#64;lru_cache(maxsize=4096)
def get_character_cell_size(character: str) -&gt; int:
â€œâ€â€Get the cell size of a character.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Args:
    character (str): A single character.

Returns:
    int: Number of cells (0, 1 or 2) occupied by that character.
&quot;&quot;&quot;
codepoint = ord(character)
_table = CELL_WIDTHS
lower_bound = 0
upper_bound = len(_table) - 1
index = (lower_bound + upper_bound) // 2
while True:
    start, end, width = _table[index]
    if codepoint &lt; start:
        upper_bound = index - 1
    elif codepoint &gt; end:
        lower_bound = index + 1
    else:
        return 0 if width == -1 else width
    if upper_bound &lt; lower_bound:
        break
    index = (lower_bound + upper_bound) // 2
return 1
</pre></div>
</div>
<p>def set_cell_size(text: str, total: int) -&gt; str:
â€œâ€â€Set the length of a string to fit within given number of cells.â€â€â€</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>if _is_single_cell_widths(text):
    size = len(text)
    if size &lt; total:
        return text + &quot; &quot; * (total - size)
    return text[:total]

if total &lt;= 0:
    return &quot;&quot;
cell_size = cell_len(text)
if cell_size == total:
    return text
if cell_size &lt; total:
    return text + &quot; &quot; * (total - cell_size)

start = 0
end = len(text)

# Binary search until we find the right size
while True:
    pos = (start + end) // 2
    before = text[: pos + 1]
    before_len = cell_len(before)
    if before_len == total + 1 and cell_len(before[-1]) == 2:
        return before[:-1] + &quot; &quot;
    if before_len == total:
        return before
    if before_len &gt; total:
        end = pos
    else:
        start = pos
</pre></div>
</div>
<p>def chop_cells(
text: str,
width: int,
) -&gt; list[str]:
â€œâ€â€Split text into lines such that each line fits within the available (cell) width.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Args:
    text: The text to fold such that it fits in the given width.
    width: The width available (number of cells).

Returns:
    A list of strings such that each string in the list has cell width
    less than or equal to the available width.
&quot;&quot;&quot;
_get_character_cell_size = get_character_cell_size
lines: list[list[str]] = [[]]

append_new_line = lines.append
append_to_last_line = lines[-1].append

total_width = 0

for character in text:
    cell_width = _get_character_cell_size(character)
    char_doesnt_fit = total_width + cell_width &gt; width

    if char_doesnt_fit:
        append_new_line([character])
        append_to_last_line = lines[-1].append
        total_width = cell_width
    else:
        append_to_last_line(character)
        total_width += cell_width

return [&quot;&quot;.join(line) for line in lines]
</pre></div>
</div>
<p>if <strong>name</strong> == â€œ<strong>main</strong>â€:  # pragma: no cover
print(get_character_cell_size(â€ğŸ˜½â€))
for line in chop_cells(â€œâ€â€è¿™æ˜¯å¯¹äºšæ´²è¯­è¨€æ”¯æŒçš„æµ‹è¯•ã€‚é¢å¯¹æ¨¡æ£±ä¸¤å¯çš„æƒ³æ³•ï¼Œæ‹’ç»çŒœæµ‹çš„è¯±æƒ‘ã€‚â€â€â€, 8):
print(line)
for n in range(80, 1, -1):
print(set_cell_size(â€œâ€â€è¿™æ˜¯å¯¹äºšæ´²è¯­è¨€æ”¯æŒçš„æµ‹è¯•ã€‚é¢å¯¹æ¨¡æ£±ä¸¤å¯çš„æƒ³æ³•ï¼Œæ‹’ç»çŒœæµ‹çš„è¯±æƒ‘ã€‚â€â€â€, n) + â€œ|â€)
print(â€œxâ€ * n)</p>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Adam Worsnip.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>