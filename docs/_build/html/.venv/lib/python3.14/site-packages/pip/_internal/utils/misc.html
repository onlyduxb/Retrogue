

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Retry every half second for up to 3 seconds &mdash; Retrogue 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/custom.css?v=a6a68382" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/fonts.css?v=5583d106" />

  
      <script src="../../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../../index.html" class="icon icon-home">
            Retrogue
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../index.html">Retrogue</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Retry every half second for up to 3 seconds</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../../_sources/.venv/lib/python3.14/site-packages/pip/_internal/utils/misc.py.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>from <strong>future</strong> import annotations</p>
<p>import errno
import getpass
import hashlib
import logging
import os
import posixpath
import shutil
import stat
import sys
import sysconfig
import urllib.parse
from collections.abc import Generator, Iterable, Iterator, Mapping, Sequence
from dataclasses import dataclass
from functools import partial
from io import StringIO
from itertools import filterfalse, tee, zip_longest
from pathlib import Path
from types import FunctionType, TracebackType
from typing import (
Any,
BinaryIO,
Callable,
Optional,
TextIO,
TypeVar,
cast,
)</p>
<p>from pip._vendor.packaging.requirements import Requirement
from pip._vendor.pyproject_hooks import BuildBackendHookCaller</p>
<p>from pip import <strong>version</strong>
from pip._internal.exceptions import CommandError, ExternallyManagedEnvironment
from pip._internal.locations import get_major_minor_version
from pip._internal.utils.compat import WINDOWS
from pip._internal.utils.retry import retry
from pip._internal.utils.virtualenv import running_under_virtualenv</p>
<p><strong>all</strong> = [
“rmtree”,
“display_path”,
“backup_dir”,
“ask”,
“splitext”,
“format_size”,
“is_installable_dir”,
“normalize_path”,
“renames”,
“get_prog”,
“ensure_dir”,
“remove_auth_from_url”,
“check_externally_managed”,
“ConfiguredBuildBackendHookCaller”,
]</p>
<p>logger = logging.getLogger(<strong>name</strong>)</p>
<p>T = TypeVar(“T”)
ExcInfo = tuple[type[BaseException], BaseException, TracebackType]
VersionInfo = tuple[int, int, int]
NetlocTuple = tuple[str, tuple[Optional[str], Optional[str]]]
OnExc = Callable[[FunctionType, Path, BaseException], Any]
OnErr = Callable[[FunctionType, Path, ExcInfo], Any]</p>
<p>FILE_CHUNK_SIZE = 1024 * 1024</p>
<p>def get_pip_version() -&gt; str:
pip_pkg_dir = os.path.join(os.path.dirname(<strong>file</strong>), “..”, “..”)
pip_pkg_dir = os.path.abspath(pip_pkg_dir)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>return f&quot;pip {__version__} from {pip_pkg_dir} (python {get_major_minor_version()})&quot;
</pre></div>
</div>
<p>def normalize_version_info(py_version_info: tuple[int, …]) -&gt; tuple[int, int, int]:
“””
Convert a tuple of ints representing a Python version to one of length
three.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>:param py_version_info: a tuple of ints representing a Python version,
    or None to specify no version. The tuple can have any length.

:return: a tuple of length three if `py_version_info` is non-None.
    Otherwise, return `py_version_info` unchanged (i.e. None).
&quot;&quot;&quot;
if len(py_version_info) &lt; 3:
    py_version_info += (3 - len(py_version_info)) * (0,)
elif len(py_version_info) &gt; 3:
    py_version_info = py_version_info[:3]

return cast(&quot;VersionInfo&quot;, py_version_info)
</pre></div>
</div>
<p>def ensure_dir(path: str) -&gt; None:
“””os.path.makedirs without EEXIST.”””
try:
os.makedirs(path)
except OSError as e:
# Windows can raise spurious ENOTEMPTY errors. See #6426.
if e.errno != errno.EEXIST and e.errno != errno.ENOTEMPTY:
raise</p>
<p>def get_prog() -&gt; str:
try:
prog = os.path.basename(sys.argv[0])
if prog in (”<strong>main</strong>.py”, “-c”):
return f”{sys.executable} -m pip”
else:
return prog
except (AttributeError, TypeError, IndexError):
pass
return “pip”</p>
<section id="retry-every-half-second-for-up-to-3-seconds">
<h1>Retry every half second for up to 3 seconds<a class="headerlink" href="#retry-every-half-second-for-up-to-3-seconds" title="Link to this heading"></a></h1>
<p>&#64;retry(stop_after_delay=3, wait=0.5)
def rmtree(dir: str, ignore_errors: bool = False, onexc: OnExc | None = None) -&gt; None:
if ignore_errors:
onexc = _onerror_ignore
if onexc is None:
onexc = _onerror_reraise
handler: OnErr = partial(rmtree_errorhandler, onexc=onexc)
if sys.version_info &gt;= (3, 12):
# See https://docs.python.org/3.12/whatsnew/3.12.html#shutil.
shutil.rmtree(dir, onexc=handler)  # type: ignore
else:
shutil.rmtree(dir, onerror=handler)  # type: ignore</p>
<p>def _onerror_ignore(*_args: Any) -&gt; None:
pass</p>
<p>def _onerror_reraise(*_args: Any) -&gt; None:
raise  # noqa: PLE0704 - Bare exception used to reraise existing exception</p>
<p>def rmtree_errorhandler(
func: FunctionType,
path: Path,
exc_info: ExcInfo | BaseException,
*,
onexc: OnExc = _onerror_reraise,
) -&gt; None:
“””
<code class="docutils literal notranslate"><span class="pre">rmtree</span></code> error handler to ‘force’ a file remove (i.e. like <code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-f</span></code>).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>* If a file is readonly then it&#39;s write flag is set and operation is
  retried.

* `onerror` is the original callback from `rmtree(... onerror=onerror)`
  that is chained at the end if the &quot;rm -f&quot; still fails.
&quot;&quot;&quot;
try:
    st_mode = os.stat(path).st_mode
except OSError:
    # it&#39;s equivalent to os.path.exists
    return

if not st_mode &amp; stat.S_IWRITE:
    # convert to read/write
    try:
        os.chmod(path, st_mode | stat.S_IWRITE)
    except OSError:
        pass
    else:
        # use the original function to repeat the operation
        try:
            func(path)
            return
        except OSError:
            pass

if not isinstance(exc_info, BaseException):
    _, exc_info, _ = exc_info
onexc(func, path, exc_info)
</pre></div>
</div>
<p>def display_path(path: str) -&gt; str:
“””Gives the display value for a given path, making it relative to cwd
if possible.”””
path = os.path.normcase(os.path.abspath(path))
if path.startswith(os.getcwd() + os.path.sep):
path = “.” + path[len(os.getcwd()) :]
return path</p>
<p>def backup_dir(dir: str, ext: str = “.bak”) -&gt; str:
“””Figure out the name of a directory to back up the given dir to
(adding .bak, .bak2, etc)”””
n = 1
extension = ext
while os.path.exists(dir + extension):
n += 1
extension = ext + str(n)
return dir + extension</p>
<p>def ask_path_exists(message: str, options: Iterable[str]) -&gt; str:
for action in os.environ.get(“PIP_EXISTS_ACTION”, “”).split():
if action in options:
return action
return ask(message, options)</p>
<p>def _check_no_input(message: str) -&gt; None:
“””Raise an error if no input is allowed.”””
if os.environ.get(“PIP_NO_INPUT”):
raise Exception(
f”No input was expected ($PIP_NO_INPUT set); question: {message}”
)</p>
<p>def ask(message: str, options: Iterable[str]) -&gt; str:
“””Ask the message interactively, with the given possible responses”””
while 1:
_check_no_input(message)
response = input(message)
response = response.strip().lower()
if response not in options:
print(
“Your response ({!r}) was not one of the expected responses: “
“{}”.format(response, “, “.join(options))
)
else:
return response</p>
<p>def ask_input(message: str) -&gt; str:
“””Ask for input interactively.”””
_check_no_input(message)
return input(message)</p>
<p>def ask_password(message: str) -&gt; str:
“””Ask for a password interactively.”””
_check_no_input(message)
return getpass.getpass(message)</p>
<p>def strtobool(val: str) -&gt; int:
“””Convert a string representation of truth to true (1) or false (0).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>True values are &#39;y&#39;, &#39;yes&#39;, &#39;t&#39;, &#39;true&#39;, &#39;on&#39;, and &#39;1&#39;; false values
are &#39;n&#39;, &#39;no&#39;, &#39;f&#39;, &#39;false&#39;, &#39;off&#39;, and &#39;0&#39;.  Raises ValueError if
&#39;val&#39; is anything else.
&quot;&quot;&quot;
val = val.lower()
if val in (&quot;y&quot;, &quot;yes&quot;, &quot;t&quot;, &quot;true&quot;, &quot;on&quot;, &quot;1&quot;):
    return 1
elif val in (&quot;n&quot;, &quot;no&quot;, &quot;f&quot;, &quot;false&quot;, &quot;off&quot;, &quot;0&quot;):
    return 0
else:
    raise ValueError(f&quot;invalid truth value {val!r}&quot;)
</pre></div>
</div>
<p>def format_size(bytes: float) -&gt; str:
if bytes &gt; 1000 * 1000:
return f”{bytes / 1000.0 / 1000:.1f} MB”
elif bytes &gt; 10 * 1000:
return f”{int(bytes / 1000)} kB”
elif bytes &gt; 1000:
return f”{bytes / 1000.0:.1f} kB”
else:
return f”{int(bytes)} bytes”</p>
<p>def tabulate(rows: Iterable[Iterable[Any]]) -&gt; tuple[list[str], list[int]]:
“””Return a list of formatted rows and a list of column sizes.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>For example::

&gt;&gt;&gt; tabulate([[&#39;foobar&#39;, 2000], [0xdeadbeef]])
([&#39;foobar     2000&#39;, &#39;3735928559&#39;], [10, 4])
&quot;&quot;&quot;
rows = [tuple(map(str, row)) for row in rows]
sizes = [max(map(len, col)) for col in zip_longest(*rows, fillvalue=&quot;&quot;)]
table = [&quot; &quot;.join(map(str.ljust, row, sizes)).rstrip() for row in rows]
return table, sizes
</pre></div>
</div>
<p>def is_installable_dir(path: str) -&gt; bool:
“””Is path is a directory containing pyproject.toml or setup.py?</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>If pyproject.toml exists, this is a PEP 517 project. Otherwise we look for
a legacy setuptools layout by identifying setup.py. We don&#39;t check for the
setup.cfg because using it without setup.py is only available for PEP 517
projects, which are already covered by the pyproject.toml check.
&quot;&quot;&quot;
if not os.path.isdir(path):
    return False
if os.path.isfile(os.path.join(path, &quot;pyproject.toml&quot;)):
    return True
if os.path.isfile(os.path.join(path, &quot;setup.py&quot;)):
    return True
return False
</pre></div>
</div>
<p>def read_chunks(
file: BinaryIO, size: int = FILE_CHUNK_SIZE
) -&gt; Generator[bytes, None, None]:
“””Yield pieces of data from a file-like object until EOF.”””
while True:
chunk = file.read(size)
if not chunk:
break
yield chunk</p>
<p>def normalize_path(path: str, resolve_symlinks: bool = True) -&gt; str:
“””
Convert a path to its canonical, case-normalized, absolute version.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;&quot;&quot;
path = os.path.expanduser(path)
if resolve_symlinks:
    path = os.path.realpath(path)
else:
    path = os.path.abspath(path)
return os.path.normcase(path)
</pre></div>
</div>
<p>def splitext(path: str) -&gt; tuple[str, str]:
“””Like os.path.splitext, but take off .tar too”””
base, ext = posixpath.splitext(path)
if base.lower().endswith(“.tar”):
ext = base[-4:] + ext
base = base[:-4]
return base, ext</p>
<p>def renames(old: str, new: str) -&gt; None:
“””Like os.renames(), but handles renaming across devices.”””
# Implementation borrowed from os.renames().
head, tail = os.path.split(new)
if head and tail and not os.path.exists(head):
os.makedirs(head)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shutil.move(old, new)

head, tail = os.path.split(old)
if head and tail:
    try:
        os.removedirs(head)
    except OSError:
        pass
</pre></div>
</div>
<p>def is_local(path: str) -&gt; bool:
“””
Return True if path is within sys.prefix, if we’re running in a virtualenv.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>If we&#39;re not in a virtualenv, all paths are considered &quot;local.&quot;

Caution: this function assumes the head of path has been normalized
with normalize_path.
&quot;&quot;&quot;
if not running_under_virtualenv():
    return True
return path.startswith(normalize_path(sys.prefix))
</pre></div>
</div>
<p>def write_output(msg: Any, *args: Any) -&gt; None:
logger.info(msg, *args)</p>
<p>class StreamWrapper(StringIO):
orig_stream: TextIO</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>@classmethod
def from_stream(cls, orig_stream: TextIO) -&gt; StreamWrapper:
    ret = cls()
    ret.orig_stream = orig_stream
    return ret

# compileall.compile_dir() needs stdout.encoding to print to stdout
# type ignore is because TextIOBase.encoding is writeable
@property
def encoding(self) -&gt; str:  # type: ignore
    return self.orig_stream.encoding
</pre></div>
</div>
</section>
<section id="simulates-an-enum">
<h1>Simulates an enum<a class="headerlink" href="#simulates-an-enum" title="Link to this heading"></a></h1>
<p>def enum(*sequential: Any, **named: Any) -&gt; type[Any]:
enums = dict(zip(sequential, range(len(sequential))), **named)
reverse = {value: key for key, value in enums.items()}
enums[“reverse_mapping”] = reverse
return type(“Enum”, (), enums)</p>
<p>def build_netloc(host: str, port: int | None) -&gt; str:
“””
Build a netloc from a host-port pair
“””
if port is None:
return host
if “:” in host:
# Only wrap host with square brackets when it is IPv6
host = f”[{host}]”
return f”{host}:{port}”</p>
<p>def build_url_from_netloc(netloc: str, scheme: str = “https”) -&gt; str:
“””
Build a full URL from a netloc.
“””
if netloc.count(“:”) &gt;= 2 and “&#64;” not in netloc and “[” not in netloc:
# It must be a bare IPv6 address, so wrap it with brackets.
netloc = f”[{netloc}]”
return f”{scheme}://{netloc}”</p>
<p>def parse_netloc(netloc: str) -&gt; tuple[str | None, int | None]:
“””
Return the host-port pair from a netloc.
“””
url = build_url_from_netloc(netloc)
parsed = urllib.parse.urlparse(url)
return parsed.hostname, parsed.port</p>
<p>def split_auth_from_netloc(netloc: str) -&gt; NetlocTuple:
“””
Parse out and remove the auth information from a netloc.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Returns: (netloc, (username, password)).
&quot;&quot;&quot;
if &quot;@&quot; not in netloc:
    return netloc, (None, None)

# Split from the right because that&#39;s how urllib.parse.urlsplit()
# behaves if more than one @ is present (which can be checked using
# the password attribute of urlsplit()&#39;s return value).
auth, netloc = netloc.rsplit(&quot;@&quot;, 1)
pw: str | None = None
if &quot;:&quot; in auth:
    # Split from the left because that&#39;s how urllib.parse.urlsplit()
    # behaves if more than one : is present (which again can be checked
    # using the password attribute of the return value)
    user, pw = auth.split(&quot;:&quot;, 1)
else:
    user, pw = auth, None

user = urllib.parse.unquote(user)
if pw is not None:
    pw = urllib.parse.unquote(pw)

return netloc, (user, pw)
</pre></div>
</div>
<p>def redact_netloc(netloc: str) -&gt; str:
“””
Replace the sensitive data in a netloc with “****”, if it exists.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>For example:
    - &quot;user:pass@example.com&quot; returns &quot;user:****@example.com&quot;
    - &quot;accesstoken@example.com&quot; returns &quot;****@example.com&quot;
&quot;&quot;&quot;
netloc, (user, password) = split_auth_from_netloc(netloc)
if user is None:
    return netloc
if password is None:
    user = &quot;****&quot;
    password = &quot;&quot;
else:
    user = urllib.parse.quote(user)
    password = &quot;:****&quot;
return f&quot;{user}{password}@{netloc}&quot;
</pre></div>
</div>
<p>def _transform_url(
url: str, transform_netloc: Callable[[str], tuple[Any, …]]
) -&gt; tuple[str, NetlocTuple]:
“””Transform and replace netloc in a url.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>transform_netloc is a function taking the netloc and returning a
tuple. The first element of this tuple is the new netloc. The
entire tuple is returned.

Returns a tuple containing the transformed url as item 0 and the
original tuple returned by transform_netloc as item 1.
&quot;&quot;&quot;
purl = urllib.parse.urlsplit(url)
netloc_tuple = transform_netloc(purl.netloc)
# stripped url
url_pieces = (purl.scheme, netloc_tuple[0], purl.path, purl.query, purl.fragment)
surl = urllib.parse.urlunsplit(url_pieces)
return surl, cast(&quot;NetlocTuple&quot;, netloc_tuple)
</pre></div>
</div>
<p>def _get_netloc(netloc: str) -&gt; NetlocTuple:
return split_auth_from_netloc(netloc)</p>
<p>def _redact_netloc(netloc: str) -&gt; tuple[str]:
return (redact_netloc(netloc),)</p>
<p>def split_auth_netloc_from_url(
url: str,
) -&gt; tuple[str, str, tuple[str | None, str | None]]:
“””
Parse a url into separate netloc, auth, and url with no auth.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Returns: (url_without_auth, netloc, (username, password))
&quot;&quot;&quot;
url_without_auth, (netloc, auth) = _transform_url(url, _get_netloc)
return url_without_auth, netloc, auth
</pre></div>
</div>
<p>def remove_auth_from_url(url: str) -&gt; str:
“””Return a copy of url with ‘username:password&#64;’ removed.”””
# username/pass params are passed to subversion through flags
# and are not recognized in the url.
return _transform_url(url, _get_netloc)[0]</p>
<p>def redact_auth_from_url(url: str) -&gt; str:
“””Replace the password in a given url with ****.”””
return _transform_url(url, _redact_netloc)[0]</p>
<p>def redact_auth_from_requirement(req: Requirement) -&gt; str:
“””Replace the password in a given requirement url with ****.”””
if not req.url:
return str(req)
return str(req).replace(req.url, redact_auth_from_url(req.url))</p>
<p>&#64;dataclass(frozen=True)
class HiddenText:
secret: str
redacted: str</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>def __repr__(self) -&gt; str:
    return f&quot;&lt;HiddenText {str(self)!r}&gt;&quot;

def __str__(self) -&gt; str:
    return self.redacted

# This is useful for testing.
def __eq__(self, other: Any) -&gt; bool:
    if type(self) is not type(other):
        return False

    # The string being used for redaction doesn&#39;t also have to match,
    # just the raw, original string.
    return self.secret == other.secret
</pre></div>
</div>
<p>def hide_value(value: str) -&gt; HiddenText:
return HiddenText(value, redacted=”****”)</p>
<p>def hide_url(url: str) -&gt; HiddenText:
redacted = redact_auth_from_url(url)
return HiddenText(url, redacted=redacted)</p>
<p>def protect_pip_from_modification_on_windows(modifying_pip: bool) -&gt; None:
“””Protection of pip.exe from modification on Windows</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>On Windows, any operation modifying pip should be run as:
    python -m pip ...
&quot;&quot;&quot;
pip_names = [
    &quot;pip&quot;,
    f&quot;pip{sys.version_info.major}&quot;,
    f&quot;pip{sys.version_info.major}.{sys.version_info.minor}&quot;,
]

# See https://github.com/pypa/pip/issues/1299 for more discussion
should_show_use_python_msg = (
    modifying_pip and WINDOWS and os.path.basename(sys.argv[0]) in pip_names
)

if should_show_use_python_msg:
    new_command = [sys.executable, &quot;-m&quot;, &quot;pip&quot;] + sys.argv[1:]
    raise CommandError(
        &quot;To modify pip, please run the following command:\n{}&quot;.format(
            &quot; &quot;.join(new_command)
        )
    )
</pre></div>
</div>
<p>def check_externally_managed() -&gt; None:
“””Check whether the current environment is externally managed.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>If the ``EXTERNALLY-MANAGED`` config file is found, the current environment
is considered externally managed, and an ExternallyManagedEnvironment is
raised.
&quot;&quot;&quot;
if running_under_virtualenv():
    return
marker = os.path.join(sysconfig.get_path(&quot;stdlib&quot;), &quot;EXTERNALLY-MANAGED&quot;)
if not os.path.isfile(marker):
    return
raise ExternallyManagedEnvironment.from_config(marker)
</pre></div>
</div>
<p>def is_console_interactive() -&gt; bool:
“””Is this console interactive?”””
return sys.stdin is not None and sys.stdin.isatty()</p>
<p>def hash_file(path: str, blocksize: int = 1 &lt;&lt; 20) -&gt; tuple[Any, int]:
“””Return (hash, length) for path using hashlib.sha256()”””</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>h = hashlib.sha256()
length = 0
with open(path, &quot;rb&quot;) as f:
    for block in read_chunks(f, size=blocksize):
        length += len(block)
        h.update(block)
return h, length
</pre></div>
</div>
<p>def pairwise(iterable: Iterable[Any]) -&gt; Iterator[tuple[Any, Any]]:
“””
Return paired elements.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>For example:
    s -&gt; (s0, s1), (s2, s3), (s4, s5), ...
&quot;&quot;&quot;
iterable = iter(iterable)
return zip_longest(iterable, iterable)
</pre></div>
</div>
<p>def partition(
pred: Callable[[T], bool], iterable: Iterable[T]
) -&gt; tuple[Iterable[T], Iterable[T]]:
“””
Use a predicate to partition entries into false entries and true entries,
like</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    partition(is_odd, range(10)) --&gt; 0 2 4 6 8   and  1 3 5 7 9
&quot;&quot;&quot;
t1, t2 = tee(iterable)
return filterfalse(pred, t1), filter(pred, t2)
</pre></div>
</div>
<p>class ConfiguredBuildBackendHookCaller(BuildBackendHookCaller):
def <strong>init</strong>(
self,
config_holder: Any,
source_dir: str,
build_backend: str,
backend_path: str | None = None,
runner: Callable[…, None] | None = None,
python_executable: str | None = None,
):
super().<strong>init</strong>(
source_dir, build_backend, backend_path, runner, python_executable
)
self.config_holder = config_holder</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>def build_wheel(
    self,
    wheel_directory: str,
    config_settings: Mapping[str, Any] | None = None,
    metadata_directory: str | None = None,
) -&gt; str:
    cs = self.config_holder.config_settings
    return super().build_wheel(
        wheel_directory, config_settings=cs, metadata_directory=metadata_directory
    )

def build_sdist(
    self,
    sdist_directory: str,
    config_settings: Mapping[str, Any] | None = None,
) -&gt; str:
    cs = self.config_holder.config_settings
    return super().build_sdist(sdist_directory, config_settings=cs)

def build_editable(
    self,
    wheel_directory: str,
    config_settings: Mapping[str, Any] | None = None,
    metadata_directory: str | None = None,
) -&gt; str:
    cs = self.config_holder.config_settings
    return super().build_editable(
        wheel_directory, config_settings=cs, metadata_directory=metadata_directory
    )

def get_requires_for_build_wheel(
    self, config_settings: Mapping[str, Any] | None = None
) -&gt; Sequence[str]:
    cs = self.config_holder.config_settings
    return super().get_requires_for_build_wheel(config_settings=cs)

def get_requires_for_build_sdist(
    self, config_settings: Mapping[str, Any] | None = None
) -&gt; Sequence[str]:
    cs = self.config_holder.config_settings
    return super().get_requires_for_build_sdist(config_settings=cs)

def get_requires_for_build_editable(
    self, config_settings: Mapping[str, Any] | None = None
) -&gt; Sequence[str]:
    cs = self.config_holder.config_settings
    return super().get_requires_for_build_editable(config_settings=cs)

def prepare_metadata_for_build_wheel(
    self,
    metadata_directory: str,
    config_settings: Mapping[str, Any] | None = None,
    _allow_fallback: bool = True,
) -&gt; str:
    cs = self.config_holder.config_settings
    return super().prepare_metadata_for_build_wheel(
        metadata_directory=metadata_directory,
        config_settings=cs,
        _allow_fallback=_allow_fallback,
    )

def prepare_metadata_for_build_editable(
    self,
    metadata_directory: str,
    config_settings: Mapping[str, Any] | None = None,
    _allow_fallback: bool = True,
) -&gt; str | None:
    cs = self.config_holder.config_settings
    return super().prepare_metadata_for_build_editable(
        metadata_directory=metadata_directory,
        config_settings=cs,
        _allow_fallback=_allow_fallback,
    )
</pre></div>
</div>
<p>def warn_if_run_as_root() -&gt; None:
“””Output a warning for sudo users on Unix.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>In a virtual environment, sudo pip still writes to virtualenv.
On Windows, users may run pip as Administrator without issues.
This warning only applies to Unix root users outside of virtualenv.
&quot;&quot;&quot;
if running_under_virtualenv():
    return
if not hasattr(os, &quot;getuid&quot;):
    return
# On Windows, there are no &quot;system managed&quot; Python packages. Installing as
# Administrator via pip is the correct way of updating system environments.
#
# We choose sys.platform over utils.compat.WINDOWS here to enable Mypy platform
# checks: https://mypy.readthedocs.io/en/stable/common_issues.html
if sys.platform == &quot;win32&quot; or sys.platform == &quot;cygwin&quot;:
    return

if os.getuid() != 0:
    return

logger.warning(
    &quot;Running pip as the &#39;root&#39; user can result in broken permissions and &quot;
    &quot;conflicting behaviour with the system package manager, possibly &quot;
    &quot;rendering your system unusable. &quot;
    &quot;It is recommended to use a virtual environment instead: &quot;
    &quot;https://pip.pypa.io/warnings/venv. &quot;
    &quot;Use the --root-user-action option if you know what you are doing and &quot;
    &quot;want to suppress this warning.&quot;
)
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Adam Worsnip.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>