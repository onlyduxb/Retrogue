

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>&lt;no title&gt; &mdash; Retrogue 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/custom.css?v=a6a68382" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/fonts.css?v=5583d106" />

  
      <script src="../../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../../index.html" class="icon icon-home">
            Retrogue
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../index.html">Retrogue</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">&lt;no title&gt;</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../../_sources/.venv/lib/python3.14/site-packages/pip/_internal/commands/search.py.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>from <strong>future</strong> import annotations</p>
<p>import logging
import shutil
import sys
import textwrap
import xmlrpc.client
from collections import OrderedDict
from optparse import Values
from typing import TypedDict</p>
<p>from pip._vendor.packaging.version import parse as parse_version</p>
<p>from pip._internal.cli.base_command import Command
from pip._internal.cli.req_command import SessionCommandMixin
from pip._internal.cli.status_codes import NO_MATCHES_FOUND, SUCCESS
from pip._internal.exceptions import CommandError
from pip._internal.metadata import get_default_environment
from pip._internal.metadata.base import BaseDistribution
from pip._internal.models.index import PyPI
from pip._internal.network.xmlrpc import PipXmlrpcTransport
from pip._internal.utils.logging import indent_log
from pip._internal.utils.misc import write_output</p>
<p>class TransformedHit(TypedDict):
name: str
summary: str
versions: list[str]</p>
<p>logger = logging.getLogger(<strong>name</strong>)</p>
<p>class SearchCommand(Command, SessionCommandMixin):
“””Search for PyPI packages whose name or summary contains <query>.”””</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>usage = &quot;&quot;&quot;
  %prog [options] &lt;query&gt;&quot;&quot;&quot;
ignore_require_venv = True

def add_options(self) -&gt; None:
    self.cmd_opts.add_option(
        &quot;-i&quot;,
        &quot;--index&quot;,
        dest=&quot;index&quot;,
        metavar=&quot;URL&quot;,
        default=PyPI.pypi_url,
        help=&quot;Base URL of Python Package Index (default %default)&quot;,
    )

    self.parser.insert_option_group(0, self.cmd_opts)

def run(self, options: Values, args: list[str]) -&gt; int:
    if not args:
        raise CommandError(&quot;Missing required argument (search query).&quot;)
    query = args
    pypi_hits = self.search(query, options)
    hits = transform_hits(pypi_hits)

    terminal_width = None
    if sys.stdout.isatty():
        terminal_width = shutil.get_terminal_size()[0]

    print_results(hits, terminal_width=terminal_width)
    if pypi_hits:
        return SUCCESS
    return NO_MATCHES_FOUND

def search(self, query: list[str], options: Values) -&gt; list[dict[str, str]]:
    index_url = options.index

    session = self.get_default_session(options)

    transport = PipXmlrpcTransport(index_url, session)
    pypi = xmlrpc.client.ServerProxy(index_url, transport)
    try:
        hits = pypi.search({&quot;name&quot;: query, &quot;summary&quot;: query}, &quot;or&quot;)
    except xmlrpc.client.Fault as fault:
        message = (
            f&quot;XMLRPC request failed [code: {fault.faultCode}]\n{fault.faultString}&quot;
        )
        raise CommandError(message)
    assert isinstance(hits, list)
    return hits
</pre></div>
</div>
<p>def transform_hits(hits: list[dict[str, str]]) -&gt; list[TransformedHit]:
“””
The list from pypi is really a list of versions. We want a list of
packages with the list of versions stored inline. This converts the
list from pypi into one we can use.
“””
packages: dict[str, TransformedHit] = OrderedDict()
for hit in hits:
name = hit[“name”]
summary = hit[“summary”]
version = hit[“version”]</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    if name not in packages.keys():
        packages[name] = {
            &quot;name&quot;: name,
            &quot;summary&quot;: summary,
            &quot;versions&quot;: [version],
        }
    else:
        packages[name][&quot;versions&quot;].append(version)

        # if this is the highest version, replace summary and score
        if version == highest_version(packages[name][&quot;versions&quot;]):
            packages[name][&quot;summary&quot;] = summary

return list(packages.values())
</pre></div>
</div>
<p>def print_dist_installation_info(latest: str, dist: BaseDistribution | None) -&gt; None:
if dist is not None:
with indent_log():
if dist.version == latest:
write_output(“INSTALLED: %s (latest)”, dist.version)
else:
write_output(“INSTALLED: %s”, dist.version)
if parse_version(latest).pre:
write_output(
“LATEST:    %s (pre-release; install”
“ with <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--pre</span></code>)”,
latest,
)
else:
write_output(“LATEST:    %s”, latest)</p>
<p>def get_installed_distribution(name: str) -&gt; BaseDistribution | None:
env = get_default_environment()
return env.get_distribution(name)</p>
<p>def print_results(
hits: list[TransformedHit],
name_column_width: int | None = None,
terminal_width: int | None = None,
) -&gt; None:
if not hits:
return
if name_column_width is None:
name_column_width = (
max(
[
len(hit[“name”]) + len(highest_version(hit.get(“versions”, [“-“])))
for hit in hits
]
)
+ 4
)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>for hit in hits:
    name = hit[&quot;name&quot;]
    summary = hit[&quot;summary&quot;] or &quot;&quot;
    latest = highest_version(hit.get(&quot;versions&quot;, [&quot;-&quot;]))
    if terminal_width is not None:
        target_width = terminal_width - name_column_width - 5
        if target_width &gt; 10:
            # wrap and indent summary to fit terminal
            summary_lines = textwrap.wrap(summary, target_width)
            summary = (&quot;\n&quot; + &quot; &quot; * (name_column_width + 3)).join(summary_lines)

    name_latest = f&quot;{name} ({latest})&quot;
    line = f&quot;{name_latest:{name_column_width}} - {summary}&quot;
    try:
        write_output(line)
        dist = get_installed_distribution(name)
        print_dist_installation_info(latest, dist)
    except UnicodeEncodeError:
        pass
</pre></div>
</div>
<p>def highest_version(versions: list[str]) -&gt; str:
return max(versions, key=parse_version)</p>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Adam Worsnip.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>