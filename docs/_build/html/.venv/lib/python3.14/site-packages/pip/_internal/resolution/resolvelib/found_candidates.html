

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>&lt;no title&gt; &mdash; Retrogue 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/custom.css?v=a6a68382" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/fonts.css?v=5583d106" />

  
      <script src="../../../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../../../index.html" class="icon icon-home">
            Retrogue
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../../index.html">Retrogue</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">&lt;no title&gt;</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../../../_sources/.venv/lib/python3.14/site-packages/pip/_internal/resolution/resolvelib/found_candidates.py.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>“””Utilities to lazily create and visit candidates found.</p>
<p>Creating and visiting a candidate is a <em>very</em> costly operation. It involves
fetching, extracting, potentially building modules from source, and verifying
distribution metadata. It is therefore crucial for performance to keep
everything here lazy all the way down, so we only touch candidates that we
absolutely need, and not “download the world” when we only need one version of
something.
“””</p>
<p>from <strong>future</strong> import annotations</p>
<p>import logging
from collections.abc import Iterator, Sequence
from typing import Any, Callable, Optional</p>
<p>from pip._vendor.packaging.version import _BaseVersion</p>
<p>from pip._internal.exceptions import MetadataInvalid</p>
<p>from .base import Candidate</p>
<p>logger = logging.getLogger(<strong>name</strong>)</p>
<p>IndexCandidateInfo = tuple[_BaseVersion, Callable[[], Optional[Candidate]]]</p>
<p>def _iter_built(infos: Iterator[IndexCandidateInfo]) -&gt; Iterator[Candidate]:
“””Iterator for <code class="docutils literal notranslate"><span class="pre">FoundCandidates</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>This iterator is used when the package is not already installed. Candidates
from index come later in their normal ordering.
&quot;&quot;&quot;
versions_found: set[_BaseVersion] = set()
for version, func in infos:
    if version in versions_found:
        continue
    try:
        candidate = func()
    except MetadataInvalid as e:
        logger.warning(
            &quot;Ignoring version %s of %s since it has invalid metadata:\n&quot;
            &quot;%s\n&quot;
            &quot;Please use pip&lt;24.1 if you need to use this version.&quot;,
            version,
            e.ireq.name,
            e,
        )
        # Mark version as found to avoid trying other candidates with the same
        # version, since they most likely have invalid metadata as well.
        versions_found.add(version)
    else:
        if candidate is None:
            continue
        yield candidate
        versions_found.add(version)
</pre></div>
</div>
<p>def _iter_built_with_prepended(
installed: Candidate, infos: Iterator[IndexCandidateInfo]
) -&gt; Iterator[Candidate]:
“””Iterator for <code class="docutils literal notranslate"><span class="pre">FoundCandidates</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>This iterator is used when the resolver prefers the already-installed
candidate and NOT to upgrade. The installed candidate is therefore
always yielded first, and candidates from index come later in their
normal ordering, except skipped when the version is already installed.
&quot;&quot;&quot;
yield installed
versions_found: set[_BaseVersion] = {installed.version}
for version, func in infos:
    if version in versions_found:
        continue
    candidate = func()
    if candidate is None:
        continue
    yield candidate
    versions_found.add(version)
</pre></div>
</div>
<p>def _iter_built_with_inserted(
installed: Candidate, infos: Iterator[IndexCandidateInfo]
) -&gt; Iterator[Candidate]:
“””Iterator for <code class="docutils literal notranslate"><span class="pre">FoundCandidates</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>This iterator is used when the resolver prefers to upgrade an
already-installed package. Candidates from index are returned in their
normal ordering, except replaced when the version is already installed.

The implementation iterates through and yields other candidates, inserting
the installed candidate exactly once before we start yielding older or
equivalent candidates, or after all other candidates if they are all newer.
&quot;&quot;&quot;
versions_found: set[_BaseVersion] = set()
for version, func in infos:
    if version in versions_found:
        continue
    # If the installed candidate is better, yield it first.
    if installed.version &gt;= version:
        yield installed
        versions_found.add(installed.version)
    candidate = func()
    if candidate is None:
        continue
    yield candidate
    versions_found.add(version)

# If the installed candidate is older than all other candidates.
if installed.version not in versions_found:
    yield installed
</pre></div>
</div>
<p>class FoundCandidates(Sequence[Candidate]):
“””A lazy sequence to provide candidates to the resolver.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The intended usage is to return this from `find_matches()` so the resolver
can iterate through the sequence multiple times, but only access the index
page when remote packages are actually needed. This improve performances
when suitable candidates are already installed on disk.
&quot;&quot;&quot;

def __init__(
    self,
    get_infos: Callable[[], Iterator[IndexCandidateInfo]],
    installed: Candidate | None,
    prefers_installed: bool,
    incompatible_ids: set[int],
):
    self._get_infos = get_infos
    self._installed = installed
    self._prefers_installed = prefers_installed
    self._incompatible_ids = incompatible_ids
    self._bool: bool | None = None

def __getitem__(self, index: Any) -&gt; Any:
    # Implemented to satisfy the ABC check. This is not needed by the
    # resolver, and should not be used by the provider either (for
    # performance reasons).
    raise NotImplementedError(&quot;don&#39;t do this&quot;)

def __iter__(self) -&gt; Iterator[Candidate]:
    infos = self._get_infos()
    if not self._installed:
        iterator = _iter_built(infos)
    elif self._prefers_installed:
        iterator = _iter_built_with_prepended(self._installed, infos)
    else:
        iterator = _iter_built_with_inserted(self._installed, infos)
    return (c for c in iterator if id(c) not in self._incompatible_ids)

def __len__(self) -&gt; int:
    # Implemented to satisfy the ABC check. This is not needed by the
    # resolver, and should not be used by the provider either (for
    # performance reasons).
    raise NotImplementedError(&quot;don&#39;t do this&quot;)

def __bool__(self) -&gt; bool:
    if self._bool is not None:
        return self._bool

    if self._prefers_installed and self._installed:
        self._bool = True
        return True

    self._bool = any(self)
    return self._bool
</pre></div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Adam Worsnip.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>