

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>&lt;no title&gt; &mdash; Retrogue 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/custom.css?v=a6a68382" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/fonts.css?v=5583d106" />

  
      <script src="../../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../../index.html" class="icon icon-home">
            Retrogue
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../index.html">Retrogue</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">&lt;no title&gt;</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../../_sources/.venv/lib/python3.14/site-packages/pip/_internal/vcs/subversion.py.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>from <strong>future</strong> import annotations</p>
<p>import logging
import os
import re</p>
<p>from pip._internal.utils.misc import (
HiddenText,
display_path,
is_console_interactive,
is_installable_dir,
split_auth_from_netloc,
)
from pip._internal.utils.subprocess import CommandArgs, make_command
from pip._internal.vcs.versioncontrol import (
AuthInfo,
RemoteNotFoundError,
RevOptions,
VersionControl,
vcs,
)</p>
<p>logger = logging.getLogger(<strong>name</strong>)</p>
<p>_svn_xml_url_re = re.compile(‘url=”(<a href="#id3"><span class="problematic" id="id1">[^&quot;]</span></a>+)”’)
_svn_rev_re = re.compile(r’committed-rev=”(\d+)”’)
_svn_info_xml_rev_re = re.compile(r’\s<em>revision=”(\d+)”’)
_svn_info_xml_url_re = re.compile(r”<url>(.</em>)</url>”)</p>
<p>class Subversion(VersionControl):
name = “svn”
dirname = “.svn”
repo_name = “checkout”
schemes = (“svn+ssh”, “svn+http”, “svn+https”, “svn+svn”, “svn+file”)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>@classmethod
def should_add_vcs_url_prefix(cls, remote_url: str) -&gt; bool:
    return True

@staticmethod
def get_base_rev_args(rev: str) -&gt; list[str]:
    return [&quot;-r&quot;, rev]

@classmethod
def get_revision(cls, location: str) -&gt; str:
    &quot;&quot;&quot;
    Return the maximum revision for all files under a given location
    &quot;&quot;&quot;
    # Note: taken from setuptools.command.egg_info
    revision = 0

    for base, dirs, _ in os.walk(location):
        if cls.dirname not in dirs:
            dirs[:] = []
            continue  # no sense walking uncontrolled subdirs
        dirs.remove(cls.dirname)
        entries_fn = os.path.join(base, cls.dirname, &quot;entries&quot;)
        if not os.path.exists(entries_fn):
            # FIXME: should we warn?
            continue

        dirurl, localrev = cls._get_svn_url_rev(base)

        if base == location:
            assert dirurl is not None
            base = dirurl + &quot;/&quot;  # save the root url
        elif not dirurl or not dirurl.startswith(base):
            dirs[:] = []
            continue  # not part of the same svn tree, skip it
        revision = max(revision, localrev)
    return str(revision)

@classmethod
def get_netloc_and_auth(
    cls, netloc: str, scheme: str
) -&gt; tuple[str, tuple[str | None, str | None]]:
    &quot;&quot;&quot;
    This override allows the auth information to be passed to svn via the
    --username and --password options instead of via the URL.
    &quot;&quot;&quot;
    if scheme == &quot;ssh&quot;:
        # The --username and --password options can&#39;t be used for
        # svn+ssh URLs, so keep the auth information in the URL.
        return super().get_netloc_and_auth(netloc, scheme)

    return split_auth_from_netloc(netloc)

@classmethod
def get_url_rev_and_auth(cls, url: str) -&gt; tuple[str, str | None, AuthInfo]:
    # hotfix the URL scheme after removing svn+ from svn+ssh:// re-add it
    url, rev, user_pass = super().get_url_rev_and_auth(url)
    if url.startswith(&quot;ssh://&quot;):
        url = &quot;svn+&quot; + url
    return url, rev, user_pass

@staticmethod
def make_rev_args(username: str | None, password: HiddenText | None) -&gt; CommandArgs:
    extra_args: CommandArgs = []
    if username:
        extra_args += [&quot;--username&quot;, username]
    if password:
        extra_args += [&quot;--password&quot;, password]

    return extra_args

@classmethod
def get_remote_url(cls, location: str) -&gt; str:
    # In cases where the source is in a subdirectory, we have to look up in
    # the location until we find a valid project root.
    orig_location = location
    while not is_installable_dir(location):
        last_location = location
        location = os.path.dirname(location)
        if location == last_location:
            # We&#39;ve traversed up to the root of the filesystem without
            # finding a Python project.
            logger.warning(
                &quot;Could not find Python project for directory %s (tried all &quot;
                &quot;parent directories)&quot;,
                orig_location,
            )
            raise RemoteNotFoundError

    url, _rev = cls._get_svn_url_rev(location)
    if url is None:
        raise RemoteNotFoundError

    return url

@classmethod
def _get_svn_url_rev(cls, location: str) -&gt; tuple[str | None, int]:
    from pip._internal.exceptions import InstallationError

    entries_path = os.path.join(location, cls.dirname, &quot;entries&quot;)
    if os.path.exists(entries_path):
        with open(entries_path) as f:
            data = f.read()
    else:  # subversion &gt;= 1.7 does not have the &#39;entries&#39; file
        data = &quot;&quot;

    url = None
    if data.startswith((&quot;8&quot;, &quot;9&quot;, &quot;10&quot;)):
        entries = list(map(str.splitlines, data.split(&quot;\n\x0c\n&quot;)))
        del entries[0][0]  # get rid of the &#39;8&#39;
        url = entries[0][3]
        revs = [int(d[9]) for d in entries if len(d) &gt; 9 and d[9]] + [0]
    elif data.startswith(&quot;&lt;?xml&quot;):
        match = _svn_xml_url_re.search(data)
        if not match:
            raise ValueError(f&quot;Badly formatted data: {data!r}&quot;)
        url = match.group(1)  # get repository URL
        revs = [int(m.group(1)) for m in _svn_rev_re.finditer(data)] + [0]
    else:
        try:
            # subversion &gt;= 1.7
            # Note that using get_remote_call_options is not necessary here
            # because `svn info` is being run against a local directory.
            # We don&#39;t need to worry about making sure interactive mode
            # is being used to prompt for passwords, because passwords
            # are only potentially needed for remote server requests.
            xml = cls.run_command(
                [&quot;info&quot;, &quot;--xml&quot;, location],
                show_stdout=False,
                stdout_only=True,
            )
            match = _svn_info_xml_url_re.search(xml)
            assert match is not None
            url = match.group(1)
            revs = [int(m.group(1)) for m in _svn_info_xml_rev_re.finditer(xml)]
        except InstallationError:
            url, revs = None, []

    if revs:
        rev = max(revs)
    else:
        rev = 0

    return url, rev

@classmethod
def is_commit_id_equal(cls, dest: str, name: str | None) -&gt; bool:
    &quot;&quot;&quot;Always assume the versions don&#39;t match&quot;&quot;&quot;
    return False

def __init__(self, use_interactive: bool | None = None) -&gt; None:
    if use_interactive is None:
        use_interactive = is_console_interactive()
    self.use_interactive = use_interactive

    # This member is used to cache the fetched version of the current
    # ``svn`` client.
    # Special value definitions:
    #   None: Not evaluated yet.
    #   Empty tuple: Could not parse version.
    self._vcs_version: tuple[int, ...] | None = None

    super().__init__()

def call_vcs_version(self) -&gt; tuple[int, ...]:
    &quot;&quot;&quot;Query the version of the currently installed Subversion client.

    :return: A tuple containing the parts of the version information or
        ``()`` if the version returned from ``svn`` could not be parsed.
    :raises: BadCommand: If ``svn`` is not installed.
    &quot;&quot;&quot;
    # Example versions:
    #   svn, version 1.10.3 (r1842928)
    #      compiled Feb 25 2019, 14:20:39 on x86_64-apple-darwin17.0.0
    #   svn, version 1.7.14 (r1542130)
    #      compiled Mar 28 2018, 08:49:13 on x86_64-pc-linux-gnu
    #   svn, version 1.12.0-SlikSvn (SlikSvn/1.12.0)
    #      compiled May 28 2019, 13:44:56 on x86_64-microsoft-windows6.2
    version_prefix = &quot;svn, version &quot;
    version = self.run_command([&quot;--version&quot;], show_stdout=False, stdout_only=True)
    if not version.startswith(version_prefix):
        return ()

    version = version[len(version_prefix) :].split()[0]
    version_list = version.partition(&quot;-&quot;)[0].split(&quot;.&quot;)
    try:
        parsed_version = tuple(map(int, version_list))
    except ValueError:
        return ()

    return parsed_version

def get_vcs_version(self) -&gt; tuple[int, ...]:
    &quot;&quot;&quot;Return the version of the currently installed Subversion client.

    If the version of the Subversion client has already been queried,
    a cached value will be used.

    :return: A tuple containing the parts of the version information or
        ``()`` if the version returned from ``svn`` could not be parsed.
    :raises: BadCommand: If ``svn`` is not installed.
    &quot;&quot;&quot;
    if self._vcs_version is not None:
        # Use cached version, if available.
        # If parsing the version failed previously (empty tuple),
        # do not attempt to parse it again.
        return self._vcs_version

    vcs_version = self.call_vcs_version()
    self._vcs_version = vcs_version
    return vcs_version

def get_remote_call_options(self) -&gt; CommandArgs:
    &quot;&quot;&quot;Return options to be used on calls to Subversion that contact the server.

    These options are applicable for the following ``svn`` subcommands used
    in this class.

        - checkout
        - switch
        - update

    :return: A list of command line arguments to pass to ``svn``.
    &quot;&quot;&quot;
    if not self.use_interactive:
        # --non-interactive switch is available since Subversion 0.14.4.
        # Subversion &lt; 1.8 runs in interactive mode by default.
        return [&quot;--non-interactive&quot;]

    svn_version = self.get_vcs_version()
    # By default, Subversion &gt;= 1.8 runs in non-interactive mode if
    # stdin is not a TTY. Since that is how pip invokes SVN, in
    # call_subprocess(), pip must pass --force-interactive to ensure
    # the user can be prompted for a password, if required.
    #   SVN added the --force-interactive option in SVN 1.8. Since
    # e.g. RHEL/CentOS 7, which is supported until 2024, ships with
    # SVN 1.7, pip should continue to support SVN 1.7. Therefore, pip
    # can&#39;t safely add the option if the SVN version is &lt; 1.8 (or unknown).
    if svn_version &gt;= (1, 8):
        return [&quot;--force-interactive&quot;]

    return []

def fetch_new(
    self, dest: str, url: HiddenText, rev_options: RevOptions, verbosity: int
) -&gt; None:
    rev_display = rev_options.to_display()
    logger.info(
        &quot;Checking out %s%s to %s&quot;,
        url,
        rev_display,
        display_path(dest),
    )
    if verbosity &lt;= 0:
        flags = [&quot;--quiet&quot;]
    else:
        flags = []
    cmd_args = make_command(
        &quot;checkout&quot;,
        *flags,
        self.get_remote_call_options(),
        rev_options.to_args(),
        url,
        dest,
    )
    self.run_command(cmd_args)

def switch(
    self,
    dest: str,
    url: HiddenText,
    rev_options: RevOptions,
    verbosity: int = 0,
) -&gt; None:
    cmd_args = make_command(
        &quot;switch&quot;,
        self.get_remote_call_options(),
        rev_options.to_args(),
        url,
        dest,
    )
    self.run_command(cmd_args)

def update(
    self,
    dest: str,
    url: HiddenText,
    rev_options: RevOptions,
    verbosity: int = 0,
) -&gt; None:
    cmd_args = make_command(
        &quot;update&quot;,
        self.get_remote_call_options(),
        rev_options.to_args(),
        dest,
    )
    self.run_command(cmd_args)
</pre></div>
</div>
<p>vcs.register(Subversion)</p>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Adam Worsnip.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>