

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All control characters from 0x00 to 0x1F except 0x1B. &mdash; Retrogue 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/custom.css?v=a6a68382" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/fonts.css?v=5583d106" />

  
      <script src="../../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../../index.html" class="icon icon-home">
            Retrogue
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../index.html">Retrogue</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">All control characters from 0x00 to 0x1F <em>except</em> 0x1B.</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../../_sources/.venv/lib/python3.14/site-packages/pip/_vendor/urllib3/fields.py.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>from <strong>future</strong> import absolute_import</p>
<p>import email.utils
import mimetypes
import re</p>
<p>from .packages import six</p>
<p>def guess_content_type(filename, default=”application/octet-stream”):
“””
Guess the “Content-Type” of a file.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>:param filename:
    The filename to guess the &quot;Content-Type&quot; of using :mod:`mimetypes`.
:param default:
    If no &quot;Content-Type&quot; can be guessed, default to `default`.
&quot;&quot;&quot;
if filename:
    return mimetypes.guess_type(filename)[0] or default
return default
</pre></div>
</div>
<p>def format_header_param_rfc2231(name, value):
“””
Helper function to format and quote a single header parameter using the
strategy defined in RFC 2231.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Particularly useful for header parameters which might contain
non-ASCII values, like file names. This follows
`RFC 2388 Section 4.4 &lt;https://tools.ietf.org/html/rfc2388#section-4.4&gt;`_.

:param name:
    The name of the parameter, a string expected to be ASCII only.
:param value:
    The value of the parameter, provided as ``bytes`` or `str``.
:ret:
    An RFC-2231-formatted unicode string.
&quot;&quot;&quot;
if isinstance(value, six.binary_type):
    value = value.decode(&quot;utf-8&quot;)

if not any(ch in value for ch in &#39;&quot;\\\r\n&#39;):
    result = u&#39;%s=&quot;%s&quot;&#39; % (name, value)
    try:
        result.encode(&quot;ascii&quot;)
    except (UnicodeEncodeError, UnicodeDecodeError):
        pass
    else:
        return result

if six.PY2:  # Python 2:
    value = value.encode(&quot;utf-8&quot;)

# encode_rfc2231 accepts an encoded string and returns an ascii-encoded
# string in Python 2 but accepts and returns unicode strings in Python 3
value = email.utils.encode_rfc2231(value, &quot;utf-8&quot;)
value = &quot;%s*=%s&quot; % (name, value)

if six.PY2:  # Python 2:
    value = value.decode(&quot;utf-8&quot;)

return value
</pre></div>
</div>
<p>_HTML5_REPLACEMENTS = {
u”\u0022”: u”%22”,
# Replace “” with “&quot;.
u”\u005C”: u”\u005C\u005C”,
}</p>
<section id="all-control-characters-from-0x00-to-0x1f-except-0x1b">
<h1>All control characters from 0x00 to 0x1F <em>except</em> 0x1B.<a class="headerlink" href="#all-control-characters-from-0x00-to-0x1f-except-0x1b" title="Link to this heading"></a></h1>
<p>_HTML5_REPLACEMENTS.update(
{
six.unichr(cc): u”%{:02X}”.format(cc)
for cc in range(0x00, 0x1F + 1)
if cc not in (0x1B,)
}
)</p>
<p>def _replace_multiple(value, needles_and_replacements):
def replacer(match):
return needles_and_replacements[match.group(0)]</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pattern = re.compile(
    r&quot;|&quot;.join([re.escape(needle) for needle in needles_and_replacements.keys()])
)

result = pattern.sub(replacer, value)

return result
</pre></div>
</div>
<p>def format_header_param_html5(name, value):
“””
Helper function to format and quote a single header parameter using the
HTML5 strategy.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Particularly useful for header parameters which might contain
non-ASCII values, like file names. This follows the `HTML5 Working Draft
Section 4.10.22.7`_ and matches the behavior of curl and modern browsers.

.. _HTML5 Working Draft Section 4.10.22.7:
    https://w3c.github.io/html/sec-forms.html#multipart-form-data

:param name:
    The name of the parameter, a string expected to be ASCII only.
:param value:
    The value of the parameter, provided as ``bytes`` or `str``.
:ret:
    A unicode string, stripped of troublesome characters.
&quot;&quot;&quot;
if isinstance(value, six.binary_type):
    value = value.decode(&quot;utf-8&quot;)

value = _replace_multiple(value, _HTML5_REPLACEMENTS)

return u&#39;%s=&quot;%s&quot;&#39; % (name, value)
</pre></div>
</div>
</section>
<section id="for-backwards-compatibility">
<h1>For backwards-compatibility.<a class="headerlink" href="#for-backwards-compatibility" title="Link to this heading"></a></h1>
<p>format_header_param = format_header_param_html5</p>
<p>class RequestField(object):
“””
A data container for request body parameters.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>:param name:
    The name of this request field. Must be unicode.
:param data:
    The data/value body.
:param filename:
    An optional filename of the request field. Must be unicode.
:param headers:
    An optional dict-like object of headers to initially use for the field.
:param header_formatter:
    An optional callable that is used to encode and format the headers. By
    default, this is :func:`format_header_param_html5`.
&quot;&quot;&quot;

def __init__(
    self,
    name,
    data,
    filename=None,
    headers=None,
    header_formatter=format_header_param_html5,
):
    self._name = name
    self._filename = filename
    self.data = data
    self.headers = {}
    if headers:
        self.headers = dict(headers)
    self.header_formatter = header_formatter

@classmethod
def from_tuples(cls, fieldname, value, header_formatter=format_header_param_html5):
    &quot;&quot;&quot;
    A :class:`~urllib3.fields.RequestField` factory from old-style tuple parameters.

    Supports constructing :class:`~urllib3.fields.RequestField` from
    parameter of key/value strings AND key/filetuple. A filetuple is a
    (filename, data, MIME type) tuple where the MIME type is optional.
    For example::

        &#39;foo&#39;: &#39;bar&#39;,
        &#39;fakefile&#39;: (&#39;foofile.txt&#39;, &#39;contents of foofile&#39;),
        &#39;realfile&#39;: (&#39;barfile.txt&#39;, open(&#39;realfile&#39;).read()),
        &#39;typedfile&#39;: (&#39;bazfile.bin&#39;, open(&#39;bazfile&#39;).read(), &#39;image/jpeg&#39;),
        &#39;nonamefile&#39;: &#39;contents of nonamefile field&#39;,

    Field names and filenames must be unicode.
    &quot;&quot;&quot;
    if isinstance(value, tuple):
        if len(value) == 3:
            filename, data, content_type = value
        else:
            filename, data = value
            content_type = guess_content_type(filename)
    else:
        filename = None
        content_type = None
        data = value

    request_param = cls(
        fieldname, data, filename=filename, header_formatter=header_formatter
    )
    request_param.make_multipart(content_type=content_type)

    return request_param

def _render_part(self, name, value):
    &quot;&quot;&quot;
    Overridable helper function to format a single header parameter. By
    default, this calls ``self.header_formatter``.

    :param name:
        The name of the parameter, a string expected to be ASCII only.
    :param value:
        The value of the parameter, provided as a unicode string.
    &quot;&quot;&quot;

    return self.header_formatter(name, value)

def _render_parts(self, header_parts):
    &quot;&quot;&quot;
    Helper function to format and quote a single header.

    Useful for single headers that are composed of multiple items. E.g.,
    &#39;Content-Disposition&#39; fields.

    :param header_parts:
        A sequence of (k, v) tuples or a :class:`dict` of (k, v) to format
        as `k1=&quot;v1&quot;; k2=&quot;v2&quot;; ...`.
    &quot;&quot;&quot;
    parts = []
    iterable = header_parts
    if isinstance(header_parts, dict):
        iterable = header_parts.items()

    for name, value in iterable:
        if value is not None:
            parts.append(self._render_part(name, value))

    return u&quot;; &quot;.join(parts)

def render_headers(self):
    &quot;&quot;&quot;
    Renders the headers for this request field.
    &quot;&quot;&quot;
    lines = []

    sort_keys = [&quot;Content-Disposition&quot;, &quot;Content-Type&quot;, &quot;Content-Location&quot;]
    for sort_key in sort_keys:
        if self.headers.get(sort_key, False):
            lines.append(u&quot;%s: %s&quot; % (sort_key, self.headers[sort_key]))

    for header_name, header_value in self.headers.items():
        if header_name not in sort_keys:
            if header_value:
                lines.append(u&quot;%s: %s&quot; % (header_name, header_value))

    lines.append(u&quot;\r\n&quot;)
    return u&quot;\r\n&quot;.join(lines)

def make_multipart(
    self, content_disposition=None, content_type=None, content_location=None
):
    &quot;&quot;&quot;
    Makes this request field into a multipart request field.

    This method overrides &quot;Content-Disposition&quot;, &quot;Content-Type&quot; and
    &quot;Content-Location&quot; headers to the request parameter.

    :param content_type:
        The &#39;Content-Type&#39; of the request body.
    :param content_location:
        The &#39;Content-Location&#39; of the request body.

    &quot;&quot;&quot;
    self.headers[&quot;Content-Disposition&quot;] = content_disposition or u&quot;form-data&quot;
    self.headers[&quot;Content-Disposition&quot;] += u&quot;; &quot;.join(
        [
            u&quot;&quot;,
            self._render_parts(
                ((u&quot;name&quot;, self._name), (u&quot;filename&quot;, self._filename))
            ),
        ]
    )
    self.headers[&quot;Content-Type&quot;] = content_type
    self.headers[&quot;Content-Location&quot;] = content_location
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Adam Worsnip.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>