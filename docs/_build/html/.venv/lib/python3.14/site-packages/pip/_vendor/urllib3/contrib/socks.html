

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>-- coding: utf-8 -- &mdash; Retrogue 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/custom.css?v=a6a68382" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/fonts.css?v=5583d106" />

  
      <script src="../../../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../../../index.html" class="icon icon-home">
            Retrogue
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../../index.html">Retrogue</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">-<em>- coding: utf-8 -</em>-</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../../../_sources/.venv/lib/python3.14/site-packages/pip/_vendor/urllib3/contrib/socks.py.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="coding-utf-8">
<h1>-<em>- coding: utf-8 -</em>-<a class="headerlink" href="#coding-utf-8" title="Link to this heading"></a></h1>
<p>“””
This module contains provisional support for SOCKS proxies from within
urllib3. This module supports SOCKS4, SOCKS4A (an extension of SOCKS4), and
SOCKS5. To enable its functionality, either install PySocks or install this
module with the <code class="docutils literal notranslate"><span class="pre">socks</span></code> extra.</p>
<p>The SOCKS implementation supports the full range of urllib3 features. It also
supports the following SOCKS features:</p>
<ul class="simple">
<li><p>SOCKS4A (<code class="docutils literal notranslate"><span class="pre">proxy_url='socks4a://...</span></code>)</p></li>
<li><p>SOCKS4 (<code class="docutils literal notranslate"><span class="pre">proxy_url='socks4://...</span></code>)</p></li>
<li><p>SOCKS5 with remote DNS (<code class="docutils literal notranslate"><span class="pre">proxy_url='socks5h://...</span></code>)</p></li>
<li><p>SOCKS5 with local DNS (<code class="docutils literal notranslate"><span class="pre">proxy_url='socks5://...</span></code>)</p></li>
<li><p>Usernames and passwords for the SOCKS proxy</p></li>
</ul>
<p>.. note::
It is recommended to use <code class="docutils literal notranslate"><span class="pre">socks5h://</span></code> or <code class="docutils literal notranslate"><span class="pre">socks4a://</span></code> schemes in
your <code class="docutils literal notranslate"><span class="pre">proxy_url</span></code> to ensure that DNS resolution is done from the remote
server instead of client-side when connecting to a domain name.</p>
<p>SOCKS4 supports IPv4 and domain names with the SOCKS4A extension. SOCKS5
supports IPv4, IPv6, and domain names.</p>
<p>When connecting to a SOCKS4 proxy the <code class="docutils literal notranslate"><span class="pre">username</span></code> portion of the <code class="docutils literal notranslate"><span class="pre">proxy_url</span></code>
will be sent as the <code class="docutils literal notranslate"><span class="pre">userid</span></code> section of the SOCKS request:</p>
<p>.. code-block:: python</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>proxy_url=&quot;socks4a://&lt;userid&gt;@proxy-host&quot;
</pre></div>
</div>
<p>When connecting to a SOCKS5 proxy the <code class="docutils literal notranslate"><span class="pre">username</span></code> and <code class="docutils literal notranslate"><span class="pre">password</span></code> portion
of the <code class="docutils literal notranslate"><span class="pre">proxy_url</span></code> will be sent as the username/password to authenticate
with the proxy:</p>
<p>.. code-block:: python</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>proxy_url=&quot;socks5h://&lt;username&gt;:&lt;password&gt;@proxy-host&quot;
</pre></div>
</div>
<p>“””
from <strong>future</strong> import absolute_import</p>
<p>try:
import socks
except ImportError:
import warnings</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>from ..exceptions import DependencyWarning

warnings.warn(
    (
        &quot;SOCKS support in urllib3 requires the installation of optional &quot;
        &quot;dependencies: specifically, PySocks.  For more information, see &quot;
        &quot;https://urllib3.readthedocs.io/en/1.26.x/contrib.html#socks-proxies&quot;
    ),
    DependencyWarning,
)
raise
</pre></div>
</div>
<p>from socket import error as SocketError
from socket import timeout as SocketTimeout</p>
<p>from ..connection import HTTPConnection, HTTPSConnection
from ..connectionpool import HTTPConnectionPool, HTTPSConnectionPool
from ..exceptions import ConnectTimeoutError, NewConnectionError
from ..poolmanager import PoolManager
from ..util.url import parse_url</p>
<p>try:
import ssl
except ImportError:
ssl = None</p>
<p>class SOCKSConnection(HTTPConnection):
“””
A plain-text HTTP connection that connects via a SOCKS proxy.
“””</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>def __init__(self, *args, **kwargs):
    self._socks_options = kwargs.pop(&quot;_socks_options&quot;)
    super(SOCKSConnection, self).__init__(*args, **kwargs)

def _new_conn(self):
    &quot;&quot;&quot;
    Establish a new connection via the SOCKS proxy.
    &quot;&quot;&quot;
    extra_kw = {}
    if self.source_address:
        extra_kw[&quot;source_address&quot;] = self.source_address

    if self.socket_options:
        extra_kw[&quot;socket_options&quot;] = self.socket_options

    try:
        conn = socks.create_connection(
            (self.host, self.port),
            proxy_type=self._socks_options[&quot;socks_version&quot;],
            proxy_addr=self._socks_options[&quot;proxy_host&quot;],
            proxy_port=self._socks_options[&quot;proxy_port&quot;],
            proxy_username=self._socks_options[&quot;username&quot;],
            proxy_password=self._socks_options[&quot;password&quot;],
            proxy_rdns=self._socks_options[&quot;rdns&quot;],
            timeout=self.timeout,
            **extra_kw
        )

    except SocketTimeout:
        raise ConnectTimeoutError(
            self,
            &quot;Connection to %s timed out. (connect timeout=%s)&quot;
            % (self.host, self.timeout),
        )

    except socks.ProxyError as e:
        # This is fragile as hell, but it seems to be the only way to raise
        # useful errors here.
        if e.socket_err:
            error = e.socket_err
            if isinstance(error, SocketTimeout):
                raise ConnectTimeoutError(
                    self,
                    &quot;Connection to %s timed out. (connect timeout=%s)&quot;
                    % (self.host, self.timeout),
                )
            else:
                raise NewConnectionError(
                    self, &quot;Failed to establish a new connection: %s&quot; % error
                )
        else:
            raise NewConnectionError(
                self, &quot;Failed to establish a new connection: %s&quot; % e
            )

    except SocketError as e:  # Defensive: PySocks should catch all these.
        raise NewConnectionError(
            self, &quot;Failed to establish a new connection: %s&quot; % e
        )

    return conn
</pre></div>
</div>
</section>
<section id="we-don-t-need-to-duplicate-the-verified-unverified-distinction-from">
<h1>We don’t need to duplicate the Verified/Unverified distinction from<a class="headerlink" href="#we-don-t-need-to-duplicate-the-verified-unverified-distinction-from" title="Link to this heading"></a></h1>
</section>
<section id="urllib3-connection-py-here-because-the-httpsconnection-will-already-have-been">
<h1>urllib3/connection.py here because the HTTPSConnection will already have been<a class="headerlink" href="#urllib3-connection-py-here-because-the-httpsconnection-will-already-have-been" title="Link to this heading"></a></h1>
</section>
<section id="correctly-set-to-either-the-verified-or-unverified-form-by-that-module-this">
<h1>correctly set to either the Verified or Unverified form by that module. This<a class="headerlink" href="#correctly-set-to-either-the-verified-or-unverified-form-by-that-module-this" title="Link to this heading"></a></h1>
</section>
<section id="means-the-sockshttpsconnection-will-automatically-be-the-correct-type">
<h1>means the SOCKSHTTPSConnection will automatically be the correct type.<a class="headerlink" href="#means-the-sockshttpsconnection-will-automatically-be-the-correct-type" title="Link to this heading"></a></h1>
<p>class SOCKSHTTPSConnection(SOCKSConnection, HTTPSConnection):
pass</p>
<p>class SOCKSHTTPConnectionPool(HTTPConnectionPool):
ConnectionCls = SOCKSConnection</p>
<p>class SOCKSHTTPSConnectionPool(HTTPSConnectionPool):
ConnectionCls = SOCKSHTTPSConnection</p>
<p>class SOCKSProxyManager(PoolManager):
“””
A version of the urllib3 ProxyManager that routes connections via the
defined SOCKS proxy.
“””</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pool_classes_by_scheme = {
    &quot;http&quot;: SOCKSHTTPConnectionPool,
    &quot;https&quot;: SOCKSHTTPSConnectionPool,
}

def __init__(
    self,
    proxy_url,
    username=None,
    password=None,
    num_pools=10,
    headers=None,
    **connection_pool_kw
):
    parsed = parse_url(proxy_url)

    if username is None and password is None and parsed.auth is not None:
        split = parsed.auth.split(&quot;:&quot;)
        if len(split) == 2:
            username, password = split
    if parsed.scheme == &quot;socks5&quot;:
        socks_version = socks.PROXY_TYPE_SOCKS5
        rdns = False
    elif parsed.scheme == &quot;socks5h&quot;:
        socks_version = socks.PROXY_TYPE_SOCKS5
        rdns = True
    elif parsed.scheme == &quot;socks4&quot;:
        socks_version = socks.PROXY_TYPE_SOCKS4
        rdns = False
    elif parsed.scheme == &quot;socks4a&quot;:
        socks_version = socks.PROXY_TYPE_SOCKS4
        rdns = True
    else:
        raise ValueError(&quot;Unable to determine SOCKS version from %s&quot; % proxy_url)

    self.proxy_url = proxy_url

    socks_options = {
        &quot;socks_version&quot;: socks_version,
        &quot;proxy_host&quot;: parsed.host,
        &quot;proxy_port&quot;: parsed.port,
        &quot;username&quot;: username,
        &quot;password&quot;: password,
        &quot;rdns&quot;: rdns,
    }
    connection_pool_kw[&quot;_socks_options&quot;] = socks_options

    super(SOCKSProxyManager, self).__init__(
        num_pools, headers, **connection_pool_kw
    )

    self.pool_classes_by_scheme = SOCKSProxyManager.pool_classes_by_scheme
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Adam Worsnip.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>