

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The following comment should be removed at some point in the future. &mdash; Retrogue 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/custom.css?v=a6a68382" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/fonts.css?v=5583d106" />

  
      <script src="../../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../../index.html" class="icon icon-home">
            Retrogue
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../index.html">Retrogue</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">The following comment should be removed at some point in the future.</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../../_sources/.venv/lib/python3.14/site-packages/pip/_internal/locations/_distutils.py.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>“””Locations where we look for configs, install stuff, etc”””</p>
<section id="the-following-comment-should-be-removed-at-some-point-in-the-future">
<h1>The following comment should be removed at some point in the future.<a class="headerlink" href="#the-following-comment-should-be-removed-at-some-point-in-the-future" title="Link to this heading"></a></h1>
</section>
<section id="mypy-strict-optional-false">
<h1>mypy: strict-optional=False<a class="headerlink" href="#mypy-strict-optional-false" title="Link to this heading"></a></h1>
</section>
<section id="if-pip-s-going-to-use-distutils-it-should-not-be-using-the-copy-that-setuptools">
<h1>If pip’s going to use distutils, it should not be using the copy that setuptools<a class="headerlink" href="#if-pip-s-going-to-use-distutils-it-should-not-be-using-the-copy-that-setuptools" title="Link to this heading"></a></h1>
</section>
<section id="might-have-injected-into-the-environment-this-is-done-by-removing-the-injected">
<h1>might have injected into the environment. This is done by removing the injected<a class="headerlink" href="#might-have-injected-into-the-environment-this-is-done-by-removing-the-injected" title="Link to this heading"></a></h1>
</section>
<section id="shim-if-it-s-injected">
<h1>shim, if it’s injected.<a class="headerlink" href="#shim-if-it-s-injected" title="Link to this heading"></a></h1>
</section>
<section id="id1">
<h1><a class="headerlink" href="#id1" title="Link to this heading"></a></h1>
</section>
<section id="see-https-github-com-pypa-pip-issues-8761-for-the-original-discussion-and">
<h1>See https://github.com/pypa/pip/issues/8761 for the original discussion and<a class="headerlink" href="#see-https-github-com-pypa-pip-issues-8761-for-the-original-discussion-and" title="Link to this heading"></a></h1>
</section>
<section id="rationale-for-why-this-is-done-within-pip">
<h1>rationale for why this is done within pip.<a class="headerlink" href="#rationale-for-why-this-is-done-within-pip" title="Link to this heading"></a></h1>
<p>from <strong>future</strong> import annotations</p>
<p>try:
<strong>import</strong>(“_distutils_hack”).remove_shim()
except (ImportError, AttributeError):
pass</p>
<p>import logging
import os
import sys
from distutils.cmd import Command as DistutilsCommand
from distutils.command.install import SCHEME_KEYS
from distutils.command.install import install as distutils_install_command
from distutils.sysconfig import get_python_lib</p>
<p>from pip._internal.models.scheme import Scheme
from pip._internal.utils.compat import WINDOWS
from pip._internal.utils.virtualenv import running_under_virtualenv</p>
<p>from .base import get_major_minor_version</p>
<p>logger = logging.getLogger(<strong>name</strong>)</p>
<p>def distutils_scheme(
dist_name: str,
user: bool = False,
home: str | None = None,
root: str | None = None,
isolated: bool = False,
prefix: str | None = None,
*,
ignore_config_files: bool = False,
) -&gt; dict[str, str]:
“””
Return a distutils install scheme
“””
from distutils.dist import Distribution</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>dist_args: dict[str, str | list[str]] = {&quot;name&quot;: dist_name}
if isolated:
    dist_args[&quot;script_args&quot;] = [&quot;--no-user-cfg&quot;]

d = Distribution(dist_args)
if not ignore_config_files:
    try:
        d.parse_config_files()
    except UnicodeDecodeError:
        paths = d.find_config_files()
        logger.warning(
            &quot;Ignore distutils configs in %s due to encoding errors.&quot;,
            &quot;, &quot;.join(os.path.basename(p) for p in paths),
        )
obj: DistutilsCommand | None = None
obj = d.get_command_obj(&quot;install&quot;, create=True)
assert obj is not None
i: distutils_install_command = obj
# NOTE: setting user or home has the side-effect of creating the home dir
# or user base for installations during finalize_options()
# ideally, we&#39;d prefer a scheme class that has no side-effects.
assert not (user and prefix), f&quot;user={user} prefix={prefix}&quot;
assert not (home and prefix), f&quot;home={home} prefix={prefix}&quot;
i.user = user or i.user
if user or home:
    i.prefix = &quot;&quot;
i.prefix = prefix or i.prefix
i.home = home or i.home
i.root = root or i.root
i.finalize_options()

scheme: dict[str, str] = {}
for key in SCHEME_KEYS:
    scheme[key] = getattr(i, &quot;install_&quot; + key)

# install_lib specified in setup.cfg should install *everything*
# into there (i.e. it takes precedence over both purelib and
# platlib).  Note, i.install_lib is *always* set after
# finalize_options(); we only want to override here if the user
# has explicitly requested it hence going back to the config
if &quot;install_lib&quot; in d.get_option_dict(&quot;install&quot;):
    scheme.update({&quot;purelib&quot;: i.install_lib, &quot;platlib&quot;: i.install_lib})

if running_under_virtualenv():
    if home:
        prefix = home
    elif user:
        prefix = i.install_userbase
    else:
        prefix = i.prefix
    scheme[&quot;headers&quot;] = os.path.join(
        prefix,
        &quot;include&quot;,
        &quot;site&quot;,
        f&quot;python{get_major_minor_version()}&quot;,
        dist_name,
    )

    if root is not None:
        path_no_drive = os.path.splitdrive(os.path.abspath(scheme[&quot;headers&quot;]))[1]
        scheme[&quot;headers&quot;] = os.path.join(root, path_no_drive[1:])

return scheme
</pre></div>
</div>
<p>def get_scheme(
dist_name: str,
user: bool = False,
home: str | None = None,
root: str | None = None,
isolated: bool = False,
prefix: str | None = None,
) -&gt; Scheme:
“””
Get the “scheme” corresponding to the input parameters. The distutils
documentation provides the context for the available schemes:
https://docs.python.org/3/install/index.html#alternate-installation</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>:param dist_name: the name of the package to retrieve the scheme for, used
    in the headers scheme path
:param user: indicates to use the &quot;user&quot; scheme
:param home: indicates to use the &quot;home&quot; scheme and provides the base
    directory for the same
:param root: root under which other directories are re-based
:param isolated: equivalent to --no-user-cfg, i.e. do not consider
    ~/.pydistutils.cfg (posix) or ~/pydistutils.cfg (non-posix) for
    scheme paths
:param prefix: indicates to use the &quot;prefix&quot; scheme and provides the
    base directory for the same
&quot;&quot;&quot;
scheme = distutils_scheme(dist_name, user, home, root, isolated, prefix)
return Scheme(
    platlib=scheme[&quot;platlib&quot;],
    purelib=scheme[&quot;purelib&quot;],
    headers=scheme[&quot;headers&quot;],
    scripts=scheme[&quot;scripts&quot;],
    data=scheme[&quot;data&quot;],
)
</pre></div>
</div>
<p>def get_bin_prefix() -&gt; str:
# XXX: In old virtualenv versions, sys.prefix can contain ‘..’ components,
# so we need to call normpath to eliminate them.
prefix = os.path.normpath(sys.prefix)
if WINDOWS:
bin_py = os.path.join(prefix, “Scripts”)
# buildout uses ‘bin’ on Windows too?
if not os.path.exists(bin_py):
bin_py = os.path.join(prefix, “bin”)
return bin_py
# Forcing to use /usr/local/bin for standard macOS framework installs
# Also log to ~/Library/Logs/ for use with the Console.app log viewer
if sys.platform[:6] == “darwin” and prefix[:16] == “/System/Library/”:
return “/usr/local/bin”
return os.path.join(prefix, “bin”)</p>
<p>def get_purelib() -&gt; str:
return get_python_lib(plat_specific=False)</p>
<p>def get_platlib() -&gt; str:
return get_python_lib(plat_specific=True)</p>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Adam Worsnip.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>