

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The following comments and HTTP headers were originally added by &mdash; Retrogue 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/custom.css?v=a6a68382" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/fonts.css?v=5583d106" />

  
      <script src="../../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../../index.html" class="icon icon-home">
            Retrogue
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../index.html">Retrogue</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">The following comments and HTTP headers were originally added by</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../../_sources/.venv/lib/python3.14/site-packages/pip/_internal/network/utils.py.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>from collections.abc import Generator</p>
<p>from pip._vendor.requests.models import Response</p>
<p>from pip._internal.exceptions import NetworkConnectionError</p>
<section id="the-following-comments-and-http-headers-were-originally-added-by">
<h1>The following comments and HTTP headers were originally added by<a class="headerlink" href="#the-following-comments-and-http-headers-were-originally-added-by" title="Link to this heading"></a></h1>
</section>
<section id="donald-stufft-in-git-commit-22c562429a61bb77172039e480873fb239dd8c03">
<h1>Donald Stufft in git commit 22c562429a61bb77172039e480873fb239dd8c03.<a class="headerlink" href="#donald-stufft-in-git-commit-22c562429a61bb77172039e480873fb239dd8c03" title="Link to this heading"></a></h1>
</section>
<section id="id1">
<h1><a class="headerlink" href="#id1" title="Link to this heading"></a></h1>
</section>
<section id="we-use-accept-encoding-identity-here-because-requests-defaults-to">
<h1>We use Accept-Encoding: identity here because requests defaults to<a class="headerlink" href="#we-use-accept-encoding-identity-here-because-requests-defaults-to" title="Link to this heading"></a></h1>
</section>
<section id="accepting-compressed-responses-this-breaks-in-a-variety-of-ways">
<h1>accepting compressed responses. This breaks in a variety of ways<a class="headerlink" href="#accepting-compressed-responses-this-breaks-in-a-variety-of-ways" title="Link to this heading"></a></h1>
</section>
<section id="depending-on-how-the-server-is-configured">
<h1>depending on how the server is configured.<a class="headerlink" href="#depending-on-how-the-server-is-configured" title="Link to this heading"></a></h1>
</section>
<section id="some-servers-will-notice-that-the-file-isn-t-a-compressible-file">
<h1>- Some servers will notice that the file isn’t a compressible file<a class="headerlink" href="#some-servers-will-notice-that-the-file-isn-t-a-compressible-file" title="Link to this heading"></a></h1>
</section>
<section id="and-will-leave-the-file-alone-and-with-an-empty-content-encoding">
<h1>and will leave the file alone and with an empty Content-Encoding<a class="headerlink" href="#and-will-leave-the-file-alone-and-with-an-empty-content-encoding" title="Link to this heading"></a></h1>
</section>
<section id="some-servers-will-notice-that-the-file-is-already-compressed-and">
<h1>- Some servers will notice that the file is already compressed and<a class="headerlink" href="#some-servers-will-notice-that-the-file-is-already-compressed-and" title="Link to this heading"></a></h1>
</section>
<section id="will-leave-the-file-alone-adding-a-content-encoding-gzip-header">
<h1>will leave the file alone, adding a Content-Encoding: gzip header<a class="headerlink" href="#will-leave-the-file-alone-adding-a-content-encoding-gzip-header" title="Link to this heading"></a></h1>
</section>
<section id="some-servers-won-t-notice-anything-at-all-and-will-take-a-file">
<h1>- Some servers won’t notice anything at all and will take a file<a class="headerlink" href="#some-servers-won-t-notice-anything-at-all-and-will-take-a-file" title="Link to this heading"></a></h1>
</section>
<section id="that-s-already-been-compressed-and-compress-it-again-and-set">
<h1>that’s already been compressed and compress it again, and set<a class="headerlink" href="#that-s-already-been-compressed-and-compress-it-again-and-set" title="Link to this heading"></a></h1>
</section>
<section id="the-content-encoding-gzip-header">
<h1>the Content-Encoding: gzip header<a class="headerlink" href="#the-content-encoding-gzip-header" title="Link to this heading"></a></h1>
</section>
<section id="by-setting-this-to-request-only-the-identity-encoding-we-re-hoping">
<h1>By setting this to request only the identity encoding we’re hoping<a class="headerlink" href="#by-setting-this-to-request-only-the-identity-encoding-we-re-hoping" title="Link to this heading"></a></h1>
</section>
<section id="to-eliminate-the-third-case-hopefully-there-does-not-exist-a-server">
<h1>to eliminate the third case.  Hopefully there does not exist a server<a class="headerlink" href="#to-eliminate-the-third-case-hopefully-there-does-not-exist-a-server" title="Link to this heading"></a></h1>
</section>
<section id="which-when-given-a-file-will-notice-it-is-already-compressed-and-that">
<h1>which when given a file will notice it is already compressed and that<a class="headerlink" href="#which-when-given-a-file-will-notice-it-is-already-compressed-and-that" title="Link to this heading"></a></h1>
</section>
<section id="you-re-not-asking-for-a-compressed-file-and-will-then-decompress-it">
<h1>you’re not asking for a compressed file and will then decompress it<a class="headerlink" href="#you-re-not-asking-for-a-compressed-file-and-will-then-decompress-it" title="Link to this heading"></a></h1>
</section>
<section id="before-sending-because-if-that-s-the-case-i-don-t-think-it-ll-ever-be">
<h1>before sending because if that’s the case I don’t think it’ll ever be<a class="headerlink" href="#before-sending-because-if-that-s-the-case-i-don-t-think-it-ll-ever-be" title="Link to this heading"></a></h1>
</section>
<section id="possible-to-make-this-work">
<h1>possible to make this work.<a class="headerlink" href="#possible-to-make-this-work" title="Link to this heading"></a></h1>
<p>HEADERS: dict[str, str] = {“Accept-Encoding”: “identity”}</p>
<p>DOWNLOAD_CHUNK_SIZE = 256 * 1024</p>
<p>def raise_for_status(resp: Response) -&gt; None:
http_error_msg = “”
if isinstance(resp.reason, bytes):
# We attempt to decode utf-8 first because some servers
# choose to localize their reason strings. If the string
# isn’t utf-8, we fall back to iso-8859-1 for all other
# encodings.
try:
reason = resp.reason.decode(“utf-8”)
except UnicodeDecodeError:
reason = resp.reason.decode(“iso-8859-1”)
else:
reason = resp.reason</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>if 400 &lt;= resp.status_code &lt; 500:
    http_error_msg = (
        f&quot;{resp.status_code} Client Error: {reason} for url: {resp.url}&quot;
    )

elif 500 &lt;= resp.status_code &lt; 600:
    http_error_msg = (
        f&quot;{resp.status_code} Server Error: {reason} for url: {resp.url}&quot;
    )

if http_error_msg:
    raise NetworkConnectionError(http_error_msg, response=resp)
</pre></div>
</div>
<p>def response_chunks(
response: Response, chunk_size: int = DOWNLOAD_CHUNK_SIZE
) -&gt; Generator[bytes, None, None]:
“””Given a requests Response, provide the data chunks.”””
try:
# Special case for urllib3.
for chunk in response.raw.stream(
chunk_size,
# We use decode_content=False here because we don’t
# want urllib3 to mess with the raw bytes we get
# from the server. If we decompress inside of
# urllib3 then we cannot verify the checksum
# because the checksum will be of the compressed
# file. This breakage will only occur if the
# server adds a Content-Encoding header, which
# depends on how the server was configured:
# - Some servers will notice that the file isn’t a
#   compressible file and will leave the file alone
#   and with an empty Content-Encoding
# - Some servers will notice that the file is
#   already compressed and will leave the file
#   alone and will add a Content-Encoding: gzip
#   header
# - Some servers won’t notice anything at all and
#   will take a file that’s already been compressed
#   and compress it again and set the
#   Content-Encoding: gzip header
#
# By setting this not to decode automatically we
# hope to eliminate problems with the second case.
decode_content=False,
):
yield chunk
except AttributeError:
# Standard file-like object.
while True:
chunk = response.raw.read(chunk_size)
if not chunk:
break
yield chunk</p>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Adam Worsnip.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>