

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>&lt;no title&gt; &mdash; Retrogue 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/custom.css?v=a6a68382" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/fonts.css?v=5583d106" />

  
      <script src="../../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../../index.html" class="icon icon-home">
            Retrogue
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../index.html">Retrogue</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">&lt;no title&gt;</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../../_sources/.venv/lib/python3.14/site-packages/pip/_internal/commands/cache.py.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>import os
import textwrap
from optparse import Values
from typing import Callable</p>
<p>from pip._internal.cli.base_command import Command
from pip._internal.cli.status_codes import ERROR, SUCCESS
from pip._internal.exceptions import CommandError, PipError
from pip._internal.utils import filesystem
from pip._internal.utils.logging import getLogger
from pip._internal.utils.misc import format_size</p>
<p>logger = getLogger(<strong>name</strong>)</p>
<p>class CacheCommand(Command):
“””
Inspect and manage pip’s wheel cache.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Subcommands:

- dir: Show the cache directory.
- info: Show information about the cache.
- list: List filenames of packages stored in the cache.
- remove: Remove one or more package from the cache.
- purge: Remove all items from the cache.

``&lt;pattern&gt;`` can be a glob expression or a package name.
&quot;&quot;&quot;

ignore_require_venv = True
usage = &quot;&quot;&quot;
    %prog dir
    %prog info
    %prog list [&lt;pattern&gt;] [--format=[human, abspath]]
    %prog remove &lt;pattern&gt;
    %prog purge
&quot;&quot;&quot;

def add_options(self) -&gt; None:
    self.cmd_opts.add_option(
        &quot;--format&quot;,
        action=&quot;store&quot;,
        dest=&quot;list_format&quot;,
        default=&quot;human&quot;,
        choices=(&quot;human&quot;, &quot;abspath&quot;),
        help=&quot;Select the output format among: human (default) or abspath&quot;,
    )

    self.parser.insert_option_group(0, self.cmd_opts)

def handler_map(self) -&gt; dict[str, Callable[[Values, list[str]], None]]:
    return {
        &quot;dir&quot;: self.get_cache_dir,
        &quot;info&quot;: self.get_cache_info,
        &quot;list&quot;: self.list_cache_items,
        &quot;remove&quot;: self.remove_cache_items,
        &quot;purge&quot;: self.purge_cache,
    }

def run(self, options: Values, args: list[str]) -&gt; int:
    handler_map = self.handler_map()

    if not options.cache_dir:
        logger.error(&quot;pip cache commands can not function since cache is disabled.&quot;)
        return ERROR

    # Determine action
    if not args or args[0] not in handler_map:
        logger.error(
            &quot;Need an action (%s) to perform.&quot;,
            &quot;, &quot;.join(sorted(handler_map)),
        )
        return ERROR

    action = args[0]

    # Error handling happens here, not in the action-handlers.
    try:
        handler_map[action](options, args[1:])
    except PipError as e:
        logger.error(e.args[0])
        return ERROR

    return SUCCESS

def get_cache_dir(self, options: Values, args: list[str]) -&gt; None:
    if args:
        raise CommandError(&quot;Too many arguments&quot;)

    logger.info(options.cache_dir)

def get_cache_info(self, options: Values, args: list[str]) -&gt; None:
    if args:
        raise CommandError(&quot;Too many arguments&quot;)

    num_http_files = len(self._find_http_files(options))
    num_packages = len(self._find_wheels(options, &quot;*&quot;))

    http_cache_location = self._cache_dir(options, &quot;http-v2&quot;)
    old_http_cache_location = self._cache_dir(options, &quot;http&quot;)
    wheels_cache_location = self._cache_dir(options, &quot;wheels&quot;)
    http_cache_size = filesystem.format_size(
        filesystem.directory_size(http_cache_location)
        + filesystem.directory_size(old_http_cache_location)
    )
    wheels_cache_size = filesystem.format_directory_size(wheels_cache_location)

    message = (
        textwrap.dedent(
            &quot;&quot;&quot;
                Package index page cache location (pip v23.3+): {http_cache_location}
                Package index page cache location (older pips): {old_http_cache_location}
                Package index page cache size: {http_cache_size}
                Number of HTTP files: {num_http_files}
                Locally built wheels location: {wheels_cache_location}
                Locally built wheels size: {wheels_cache_size}
                Number of locally built wheels: {package_count}
            &quot;&quot;&quot;  # noqa: E501
        )
        .format(
            http_cache_location=http_cache_location,
            old_http_cache_location=old_http_cache_location,
            http_cache_size=http_cache_size,
            num_http_files=num_http_files,
            wheels_cache_location=wheels_cache_location,
            package_count=num_packages,
            wheels_cache_size=wheels_cache_size,
        )
        .strip()
    )

    logger.info(message)

def list_cache_items(self, options: Values, args: list[str]) -&gt; None:
    if len(args) &gt; 1:
        raise CommandError(&quot;Too many arguments&quot;)

    if args:
        pattern = args[0]
    else:
        pattern = &quot;*&quot;

    files = self._find_wheels(options, pattern)
    if options.list_format == &quot;human&quot;:
        self.format_for_human(files)
    else:
        self.format_for_abspath(files)

def format_for_human(self, files: list[str]) -&gt; None:
    if not files:
        logger.info(&quot;No locally built wheels cached.&quot;)
        return

    results = []
    for filename in files:
        wheel = os.path.basename(filename)
        size = filesystem.format_file_size(filename)
        results.append(f&quot; - {wheel} ({size})&quot;)
    logger.info(&quot;Cache contents:\n&quot;)
    logger.info(&quot;\n&quot;.join(sorted(results)))

def format_for_abspath(self, files: list[str]) -&gt; None:
    if files:
        logger.info(&quot;\n&quot;.join(sorted(files)))

def remove_cache_items(self, options: Values, args: list[str]) -&gt; None:
    if len(args) &gt; 1:
        raise CommandError(&quot;Too many arguments&quot;)

    if not args:
        raise CommandError(&quot;Please provide a pattern&quot;)

    files = self._find_wheels(options, args[0])

    no_matching_msg = &quot;No matching packages&quot;
    if args[0] == &quot;*&quot;:
        # Only fetch http files if no specific pattern given
        files += self._find_http_files(options)
    else:
        # Add the pattern to the log message
        no_matching_msg += f&#39; for pattern &quot;{args[0]}&quot;&#39;

    if not files:
        logger.warning(no_matching_msg)

    bytes_removed = 0
    for filename in files:
        bytes_removed += os.stat(filename).st_size
        os.unlink(filename)
        logger.verbose(&quot;Removed %s&quot;, filename)
    logger.info(&quot;Files removed: %s (%s)&quot;, len(files), format_size(bytes_removed))

def purge_cache(self, options: Values, args: list[str]) -&gt; None:
    if args:
        raise CommandError(&quot;Too many arguments&quot;)

    return self.remove_cache_items(options, [&quot;*&quot;])

def _cache_dir(self, options: Values, subdir: str) -&gt; str:
    return os.path.join(options.cache_dir, subdir)

def _find_http_files(self, options: Values) -&gt; list[str]:
    old_http_dir = self._cache_dir(options, &quot;http&quot;)
    new_http_dir = self._cache_dir(options, &quot;http-v2&quot;)
    return filesystem.find_files(old_http_dir, &quot;*&quot;) + filesystem.find_files(
        new_http_dir, &quot;*&quot;
    )

def _find_wheels(self, options: Values, pattern: str) -&gt; list[str]:
    wheel_dir = self._cache_dir(options, &quot;wheels&quot;)

    # The wheel filename format, as specified in PEP 427, is:
    #     {distribution}-{version}(-{build})?-{python}-{abi}-{platform}.whl
    #
    # Additionally, non-alphanumeric values in the distribution are
    # normalized to underscores (_), meaning hyphens can never occur
    # before `-{version}`.
    #
    # Given that information:
    # - If the pattern we&#39;re given contains a hyphen (-), the user is
    #   providing at least the version. Thus, we can just append `*.whl`
    #   to match the rest of it.
    # - If the pattern we&#39;re given doesn&#39;t contain a hyphen (-), the
    #   user is only providing the name. Thus, we append `-*.whl` to
    #   match the hyphen before the version, followed by anything else.
    #
    # PEP 427: https://www.python.org/dev/peps/pep-0427/
    pattern = pattern + (&quot;*.whl&quot; if &quot;-&quot; in pattern else &quot;-*.whl&quot;)

    return filesystem.find_files(wheel_dir, pattern)
</pre></div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Adam Worsnip.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>