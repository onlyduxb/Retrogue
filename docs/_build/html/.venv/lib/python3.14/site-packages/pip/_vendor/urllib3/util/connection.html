

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>This function is copied from socket.py in the Python 2.7 standard &mdash; Retrogue 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/custom.css?v=a6a68382" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/fonts.css?v=5583d106" />

  
      <script src="../../../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../../../index.html" class="icon icon-home">
            Retrogue
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../../index.html">Retrogue</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">This function is copied from socket.py in the Python 2.7 standard</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../../../_sources/.venv/lib/python3.14/site-packages/pip/_vendor/urllib3/util/connection.py.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>from <strong>future</strong> import absolute_import</p>
<p>import socket</p>
<p>from ..contrib import _appengine_environ
from ..exceptions import LocationParseError
from ..packages import six
from .wait import NoWayToWaitForSocketError, wait_for_read</p>
<p>def is_connection_dropped(conn):  # Platform-specific
“””
Returns True if the connection is dropped and should be closed.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>:param conn:
    :class:`http.client.HTTPConnection` object.

Note: For platforms like AppEngine, this will always return ``False`` to
let the platform handle connection recycling transparently for us.
&quot;&quot;&quot;
sock = getattr(conn, &quot;sock&quot;, False)
if sock is False:  # Platform-specific: AppEngine
    return False
if sock is None:  # Connection already closed (such as by httplib).
    return True
try:
    # Returns True if readable, which here means it&#39;s been dropped
    return wait_for_read(sock, timeout=0.0)
except NoWayToWaitForSocketError:  # Platform-specific: AppEngine
    return False
</pre></div>
</div>
<section id="this-function-is-copied-from-socket-py-in-the-python-2-7-standard">
<h1>This function is copied from socket.py in the Python 2.7 standard<a class="headerlink" href="#this-function-is-copied-from-socket-py-in-the-python-2-7-standard" title="Link to this heading"></a></h1>
</section>
<section id="library-test-suite-added-to-its-signature-is-only-socket-options">
<h1>library test suite. Added to its signature is only <code class="docutils literal notranslate"><span class="pre">socket_options</span></code>.<a class="headerlink" href="#library-test-suite-added-to-its-signature-is-only-socket-options" title="Link to this heading"></a></h1>
</section>
<section id="one-additional-modification-is-that-we-avoid-binding-to-ipv6-servers">
<h1>One additional modification is that we avoid binding to IPv6 servers<a class="headerlink" href="#one-additional-modification-is-that-we-avoid-binding-to-ipv6-servers" title="Link to this heading"></a></h1>
</section>
<section id="discovered-in-dns-if-the-system-doesn-t-have-ipv6-functionality">
<h1>discovered in DNS if the system doesn’t have IPv6 functionality.<a class="headerlink" href="#discovered-in-dns-if-the-system-doesn-t-have-ipv6-functionality" title="Link to this heading"></a></h1>
<p>def create_connection(
address,
timeout=socket._GLOBAL_DEFAULT_TIMEOUT,
source_address=None,
socket_options=None,
):
“””Connect to <em>address</em> and return the socket object.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Convenience function.  Connect to *address* (a 2-tuple ``(host,
port)``) and return the socket object.  Passing the optional
*timeout* parameter will set the timeout on the socket instance
before attempting to connect.  If no *timeout* is supplied, the
global default timeout setting returned by :func:`socket.getdefaulttimeout`
is used.  If *source_address* is set it must be a tuple of (host, port)
for the socket to bind as a source address before making the connection.
An host of &#39;&#39; or port 0 tells the OS to use the default.
&quot;&quot;&quot;

host, port = address
if host.startswith(&quot;[&quot;):
    host = host.strip(&quot;[]&quot;)
err = None

# Using the value from allowed_gai_family() in the context of getaddrinfo lets
# us select whether to work with IPv4 DNS records, IPv6 records, or both.
# The original create_connection function always returns all records.
family = allowed_gai_family()

try:
    host.encode(&quot;idna&quot;)
except UnicodeError:
    return six.raise_from(
        LocationParseError(u&quot;&#39;%s&#39;, label empty or too long&quot; % host), None
    )

for res in socket.getaddrinfo(host, port, family, socket.SOCK_STREAM):
    af, socktype, proto, canonname, sa = res
    sock = None
    try:
        sock = socket.socket(af, socktype, proto)

        # If provided, set socket level options before connecting.
        _set_socket_options(sock, socket_options)

        if timeout is not socket._GLOBAL_DEFAULT_TIMEOUT:
            sock.settimeout(timeout)
        if source_address:
            sock.bind(source_address)
        sock.connect(sa)
        return sock

    except socket.error as e:
        err = e
        if sock is not None:
            sock.close()
            sock = None

if err is not None:
    raise err

raise socket.error(&quot;getaddrinfo returns an empty list&quot;)
</pre></div>
</div>
<p>def _set_socket_options(sock, options):
if options is None:
return</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>for opt in options:
    sock.setsockopt(*opt)
</pre></div>
</div>
<p>def allowed_gai_family():
“””This function is designed to work in the context of
getaddrinfo, where family=socket.AF_UNSPEC is the default and
will perform a DNS search for both IPv6 and IPv4 records.”””</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>family = socket.AF_INET
if HAS_IPV6:
    family = socket.AF_UNSPEC
return family
</pre></div>
</div>
<p>def _has_ipv6(host):
“””Returns True if the system can bind an IPv6 address.”””
sock = None
has_ipv6 = False</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># App Engine doesn&#39;t support IPV6 sockets and actually has a quota on the
# number of sockets that can be used, so just early out here instead of
# creating a socket needlessly.
# See https://github.com/urllib3/urllib3/issues/1446
if _appengine_environ.is_appengine_sandbox():
    return False

if socket.has_ipv6:
    # has_ipv6 returns true if cPython was compiled with IPv6 support.
    # It does not tell us if the system has IPv6 support enabled. To
    # determine that we must bind to an IPv6 address.
    # https://github.com/urllib3/urllib3/pull/611
    # https://bugs.python.org/issue658327
    try:
        sock = socket.socket(socket.AF_INET6)
        sock.bind((host, 0))
        has_ipv6 = True
    except Exception:
        pass

if sock:
    sock.close()
return has_ipv6
</pre></div>
</div>
<p>HAS_IPV6 = _has_ipv6(“::1”)</p>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Adam Worsnip.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>