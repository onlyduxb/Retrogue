

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>&lt;no title&gt; &mdash; Retrogue 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/custom.css?v=a6a68382" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/fonts.css?v=5583d106" />

  
      <script src="../../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../../index.html" class="icon icon-home">
            Retrogue
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../index.html">Retrogue</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">&lt;no title&gt;</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../../_sources/.venv/lib/python3.14/site-packages/pip/_internal/vcs/mercurial.py.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>from <strong>future</strong> import annotations</p>
<p>import configparser
import logging
import os</p>
<p>from pip._internal.exceptions import BadCommand, InstallationError
from pip._internal.utils.misc import HiddenText, display_path
from pip._internal.utils.subprocess import make_command
from pip._internal.utils.urls import path_to_url
from pip._internal.vcs.versioncontrol import (
RevOptions,
VersionControl,
find_path_to_project_root_from_repo_root,
vcs,
)</p>
<p>logger = logging.getLogger(<strong>name</strong>)</p>
<p>class Mercurial(VersionControl):
name = “hg”
dirname = “.hg”
repo_name = “clone”
schemes = (
“hg+file”,
“hg+http”,
“hg+https”,
“hg+ssh”,
“hg+static-http”,
)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>@staticmethod
def get_base_rev_args(rev: str) -&gt; list[str]:
    return [f&quot;--rev={rev}&quot;]

def fetch_new(
    self, dest: str, url: HiddenText, rev_options: RevOptions, verbosity: int
) -&gt; None:
    rev_display = rev_options.to_display()
    logger.info(
        &quot;Cloning hg %s%s to %s&quot;,
        url,
        rev_display,
        display_path(dest),
    )
    if verbosity &lt;= 0:
        flags: tuple[str, ...] = (&quot;--quiet&quot;,)
    elif verbosity == 1:
        flags = ()
    elif verbosity == 2:
        flags = (&quot;--verbose&quot;,)
    else:
        flags = (&quot;--verbose&quot;, &quot;--debug&quot;)
    self.run_command(make_command(&quot;clone&quot;, &quot;--noupdate&quot;, *flags, url, dest))
    self.run_command(
        make_command(&quot;update&quot;, *flags, rev_options.to_args()),
        cwd=dest,
    )

def switch(
    self,
    dest: str,
    url: HiddenText,
    rev_options: RevOptions,
    verbosity: int = 0,
) -&gt; None:
    extra_flags = []
    repo_config = os.path.join(dest, self.dirname, &quot;hgrc&quot;)
    config = configparser.RawConfigParser()

    if verbosity &lt;= 0:
        extra_flags.append(&quot;-q&quot;)

    try:
        config.read(repo_config)
        config.set(&quot;paths&quot;, &quot;default&quot;, url.secret)
        with open(repo_config, &quot;w&quot;) as config_file:
            config.write(config_file)
    except (OSError, configparser.NoSectionError) as exc:
        logger.warning(&quot;Could not switch Mercurial repository to %s: %s&quot;, url, exc)
    else:
        cmd_args = make_command(&quot;update&quot;, *extra_flags, rev_options.to_args())
        self.run_command(cmd_args, cwd=dest)

def update(
    self,
    dest: str,
    url: HiddenText,
    rev_options: RevOptions,
    verbosity: int = 0,
) -&gt; None:
    extra_flags = []

    if verbosity &lt;= 0:
        extra_flags.append(&quot;-q&quot;)

    self.run_command([&quot;pull&quot;, *extra_flags], cwd=dest)
    cmd_args = make_command(&quot;update&quot;, *extra_flags, rev_options.to_args())
    self.run_command(cmd_args, cwd=dest)

@classmethod
def get_remote_url(cls, location: str) -&gt; str:
    url = cls.run_command(
        [&quot;showconfig&quot;, &quot;paths.default&quot;],
        show_stdout=False,
        stdout_only=True,
        cwd=location,
    ).strip()
    if cls._is_local_repository(url):
        url = path_to_url(url)
    return url.strip()

@classmethod
def get_revision(cls, location: str) -&gt; str:
    &quot;&quot;&quot;
    Return the repository-local changeset revision number, as an integer.
    &quot;&quot;&quot;
    current_revision = cls.run_command(
        [&quot;parents&quot;, &quot;--template={rev}&quot;],
        show_stdout=False,
        stdout_only=True,
        cwd=location,
    ).strip()
    return current_revision

@classmethod
def get_requirement_revision(cls, location: str) -&gt; str:
    &quot;&quot;&quot;
    Return the changeset identification hash, as a 40-character
    hexadecimal string
    &quot;&quot;&quot;
    current_rev_hash = cls.run_command(
        [&quot;parents&quot;, &quot;--template={node}&quot;],
        show_stdout=False,
        stdout_only=True,
        cwd=location,
    ).strip()
    return current_rev_hash

@classmethod
def is_commit_id_equal(cls, dest: str, name: str | None) -&gt; bool:
    &quot;&quot;&quot;Always assume the versions don&#39;t match&quot;&quot;&quot;
    return False

@classmethod
def get_subdirectory(cls, location: str) -&gt; str | None:
    &quot;&quot;&quot;
    Return the path to Python project root, relative to the repo root.
    Return None if the project root is in the repo root.
    &quot;&quot;&quot;
    # find the repo root
    repo_root = cls.run_command(
        [&quot;root&quot;], show_stdout=False, stdout_only=True, cwd=location
    ).strip()
    if not os.path.isabs(repo_root):
        repo_root = os.path.abspath(os.path.join(location, repo_root))
    return find_path_to_project_root_from_repo_root(location, repo_root)

@classmethod
def get_repository_root(cls, location: str) -&gt; str | None:
    loc = super().get_repository_root(location)
    if loc:
        return loc
    try:
        r = cls.run_command(
            [&quot;root&quot;],
            cwd=location,
            show_stdout=False,
            stdout_only=True,
            on_returncode=&quot;raise&quot;,
            log_failed_cmd=False,
        )
    except BadCommand:
        logger.debug(
            &quot;could not determine if %s is under hg control &quot;
            &quot;because hg is not available&quot;,
            location,
        )
        return None
    except InstallationError:
        return None
    return os.path.normpath(r.rstrip(&quot;\r\n&quot;))
</pre></div>
</div>
<p>vcs.register(Mercurial)</p>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Adam Worsnip.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>