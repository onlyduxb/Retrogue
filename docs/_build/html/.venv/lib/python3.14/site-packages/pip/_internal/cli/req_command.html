

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>&lt;no title&gt; &mdash; Retrogue 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/custom.css?v=a6a68382" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/fonts.css?v=5583d106" />

  
      <script src="../../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../../index.html" class="icon icon-home">
            Retrogue
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../index.html">Retrogue</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">&lt;no title&gt;</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../../_sources/.venv/lib/python3.14/site-packages/pip/_internal/cli/req_command.py.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>“””Contains the RequirementCommand base class.</p>
<p>This class is in a separate module so the commands that do not always
need PackageFinder capability don’t unnecessarily import the
PackageFinder machinery and all its vendored dependencies, etc.
“””</p>
<p>from <strong>future</strong> import annotations</p>
<p>import logging
import os
from functools import partial
from optparse import Values
from typing import Any, Callable, TypeVar</p>
<p>from pip._internal.build_env import SubprocessBuildEnvironmentInstaller
from pip._internal.cache import WheelCache
from pip._internal.cli import cmdoptions
from pip._internal.cli.index_command import IndexGroupCommand
from pip._internal.cli.index_command import SessionCommandMixin as SessionCommandMixin
from pip._internal.exceptions import CommandError, PreviousBuildDirError
from pip._internal.index.collector import LinkCollector
from pip._internal.index.package_finder import PackageFinder
from pip._internal.models.selection_prefs import SelectionPreferences
from pip._internal.models.target_python import TargetPython
from pip._internal.network.session import PipSession
from pip._internal.operations.build.build_tracker import BuildTracker
from pip._internal.operations.prepare import RequirementPreparer
from pip._internal.req.constructors import (
install_req_from_editable,
install_req_from_line,
install_req_from_parsed_requirement,
install_req_from_req_string,
)
from pip._internal.req.req_dependency_group import parse_dependency_groups
from pip._internal.req.req_file import parse_requirements
from pip._internal.req.req_install import InstallRequirement
from pip._internal.resolution.base import BaseResolver
from pip._internal.utils.temp_dir import (
TempDirectory,
TempDirectoryTypeRegistry,
tempdir_kinds,
)</p>
<p>logger = logging.getLogger(<strong>name</strong>)</p>
<p>def should_ignore_regular_constraints(options: Values) -&gt; bool:
“””
Check if regular constraints should be ignored because
we are in a isolated build process and build constraints
feature is enabled but no build constraints were passed.
“””</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>return os.environ.get(&quot;_PIP_IN_BUILD_IGNORE_CONSTRAINTS&quot;) == &quot;1&quot;
</pre></div>
</div>
<p>KEEPABLE_TEMPDIR_TYPES = [
tempdir_kinds.BUILD_ENV,
tempdir_kinds.EPHEM_WHEEL_CACHE,
tempdir_kinds.REQ_BUILD,
]</p>
<p>_CommandT = TypeVar(“_CommandT”, bound=”RequirementCommand”)</p>
<p>def with_cleanup(
func: Callable[[_CommandT, Values, list[str]], int],
) -&gt; Callable[[_CommandT, Values, list[str]], int]:
“””Decorator for common logic related to managing temporary
directories.
“””</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>def configure_tempdir_registry(registry: TempDirectoryTypeRegistry) -&gt; None:
    for t in KEEPABLE_TEMPDIR_TYPES:
        registry.set_delete(t, False)

def wrapper(self: _CommandT, options: Values, args: list[str]) -&gt; int:
    assert self.tempdir_registry is not None
    if options.no_clean:
        configure_tempdir_registry(self.tempdir_registry)

    try:
        return func(self, options, args)
    except PreviousBuildDirError:
        # This kind of conflict can occur when the user passes an explicit
        # build directory with a pre-existing folder. In that case we do
        # not want to accidentally remove it.
        configure_tempdir_registry(self.tempdir_registry)
        raise

return wrapper
</pre></div>
</div>
<p>class RequirementCommand(IndexGroupCommand):
def <strong>init</strong>(self, *args: Any, **kw: Any) -&gt; None:
super().<strong>init</strong>(*args, **kw)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    self.cmd_opts.add_option(cmdoptions.dependency_groups())
    self.cmd_opts.add_option(cmdoptions.no_clean())

@staticmethod
def determine_resolver_variant(options: Values) -&gt; str:
    &quot;&quot;&quot;Determines which resolver should be used, based on the given options.&quot;&quot;&quot;
    if &quot;legacy-resolver&quot; in options.deprecated_features_enabled:
        return &quot;legacy&quot;

    return &quot;resolvelib&quot;

@classmethod
def make_requirement_preparer(
    cls,
    temp_build_dir: TempDirectory,
    options: Values,
    build_tracker: BuildTracker,
    session: PipSession,
    finder: PackageFinder,
    use_user_site: bool,
    download_dir: str | None = None,
    verbosity: int = 0,
) -&gt; RequirementPreparer:
    &quot;&quot;&quot;
    Create a RequirementPreparer instance for the given parameters.
    &quot;&quot;&quot;
    temp_build_dir_path = temp_build_dir.path
    assert temp_build_dir_path is not None
    legacy_resolver = False

    resolver_variant = cls.determine_resolver_variant(options)
    if resolver_variant == &quot;resolvelib&quot;:
        lazy_wheel = &quot;fast-deps&quot; in options.features_enabled
        if lazy_wheel:
            logger.warning(
                &quot;pip is using lazily downloaded wheels using HTTP &quot;
                &quot;range requests to obtain dependency information. &quot;
                &quot;This experimental feature is enabled through &quot;
                &quot;--use-feature=fast-deps and it is not ready for &quot;
                &quot;production.&quot;
            )
    else:
        legacy_resolver = True
        lazy_wheel = False
        if &quot;fast-deps&quot; in options.features_enabled:
            logger.warning(
                &quot;fast-deps has no effect when used with the legacy resolver.&quot;
            )

    # Handle build constraints
    build_constraints = getattr(options, &quot;build_constraints&quot;, [])
    build_constraint_feature_enabled = (
        &quot;build-constraint&quot; in options.features_enabled
    )

    return RequirementPreparer(
        build_dir=temp_build_dir_path,
        src_dir=options.src_dir,
        download_dir=download_dir,
        build_isolation=options.build_isolation,
        build_isolation_installer=SubprocessBuildEnvironmentInstaller(
            finder,
            build_constraints=build_constraints,
            build_constraint_feature_enabled=build_constraint_feature_enabled,
        ),
        check_build_deps=options.check_build_deps,
        build_tracker=build_tracker,
        session=session,
        progress_bar=options.progress_bar,
        finder=finder,
        require_hashes=options.require_hashes,
        use_user_site=use_user_site,
        lazy_wheel=lazy_wheel,
        verbosity=verbosity,
        legacy_resolver=legacy_resolver,
        resume_retries=options.resume_retries,
    )

@classmethod
def make_resolver(
    cls,
    preparer: RequirementPreparer,
    finder: PackageFinder,
    options: Values,
    wheel_cache: WheelCache | None = None,
    use_user_site: bool = False,
    ignore_installed: bool = True,
    ignore_requires_python: bool = False,
    force_reinstall: bool = False,
    upgrade_strategy: str = &quot;to-satisfy-only&quot;,
    py_version_info: tuple[int, ...] | None = None,
) -&gt; BaseResolver:
    &quot;&quot;&quot;
    Create a Resolver instance for the given parameters.
    &quot;&quot;&quot;
    make_install_req = partial(
        install_req_from_req_string,
        isolated=options.isolated_mode,
    )
    resolver_variant = cls.determine_resolver_variant(options)
    # The long import name and duplicated invocation is needed to convince
    # Mypy into correctly typechecking. Otherwise it would complain the
    # &quot;Resolver&quot; class being redefined.
    if resolver_variant == &quot;resolvelib&quot;:
        import pip._internal.resolution.resolvelib.resolver

        return pip._internal.resolution.resolvelib.resolver.Resolver(
            preparer=preparer,
            finder=finder,
            wheel_cache=wheel_cache,
            make_install_req=make_install_req,
            use_user_site=use_user_site,
            ignore_dependencies=options.ignore_dependencies,
            ignore_installed=ignore_installed,
            ignore_requires_python=ignore_requires_python,
            force_reinstall=force_reinstall,
            upgrade_strategy=upgrade_strategy,
            py_version_info=py_version_info,
        )
    import pip._internal.resolution.legacy.resolver

    return pip._internal.resolution.legacy.resolver.Resolver(
        preparer=preparer,
        finder=finder,
        wheel_cache=wheel_cache,
        make_install_req=make_install_req,
        use_user_site=use_user_site,
        ignore_dependencies=options.ignore_dependencies,
        ignore_installed=ignore_installed,
        ignore_requires_python=ignore_requires_python,
        force_reinstall=force_reinstall,
        upgrade_strategy=upgrade_strategy,
        py_version_info=py_version_info,
    )

def get_requirements(
    self,
    args: list[str],
    options: Values,
    finder: PackageFinder,
    session: PipSession,
) -&gt; list[InstallRequirement]:
    &quot;&quot;&quot;
    Parse command-line arguments into the corresponding requirements.
    &quot;&quot;&quot;
    requirements: list[InstallRequirement] = []

    if not should_ignore_regular_constraints(options):
        for filename in options.constraints:
            for parsed_req in parse_requirements(
                filename,
                constraint=True,
                finder=finder,
                options=options,
                session=session,
            ):
                req_to_add = install_req_from_parsed_requirement(
                    parsed_req,
                    isolated=options.isolated_mode,
                    user_supplied=False,
                )
                requirements.append(req_to_add)

    for req in args:
        req_to_add = install_req_from_line(
            req,
            comes_from=None,
            isolated=options.isolated_mode,
            user_supplied=True,
            config_settings=getattr(options, &quot;config_settings&quot;, None),
        )
        requirements.append(req_to_add)

    if options.dependency_groups:
        for req in parse_dependency_groups(options.dependency_groups):
            req_to_add = install_req_from_req_string(
                req,
                isolated=options.isolated_mode,
                user_supplied=True,
            )
            requirements.append(req_to_add)

    for req in options.editables:
        req_to_add = install_req_from_editable(
            req,
            user_supplied=True,
            isolated=options.isolated_mode,
            config_settings=getattr(options, &quot;config_settings&quot;, None),
        )
        requirements.append(req_to_add)

    # NOTE: options.require_hashes may be set if --require-hashes is True
    for filename in options.requirements:
        for parsed_req in parse_requirements(
            filename, finder=finder, options=options, session=session
        ):
            req_to_add = install_req_from_parsed_requirement(
                parsed_req,
                isolated=options.isolated_mode,
                user_supplied=True,
                config_settings=(
                    parsed_req.options.get(&quot;config_settings&quot;)
                    if parsed_req.options
                    else None
                ),
            )
            requirements.append(req_to_add)

    # If any requirement has hash options, enable hash checking.
    if any(req.has_hash_options for req in requirements):
        options.require_hashes = True

    if not (
        args
        or options.editables
        or options.requirements
        or options.dependency_groups
    ):
        opts = {&quot;name&quot;: self.name}
        if options.find_links:
            raise CommandError(
                &quot;You must give at least one requirement to {name} &quot;
                &#39;(maybe you meant &quot;pip {name} {links}&quot;?)&#39;.format(
                    **dict(opts, links=&quot; &quot;.join(options.find_links))
                )
            )
        else:
            raise CommandError(
                &quot;You must give at least one requirement to {name} &quot;
                &#39;(see &quot;pip help {name}&quot;)&#39;.format(**opts)
            )

    return requirements

@staticmethod
def trace_basic_info(finder: PackageFinder) -&gt; None:
    &quot;&quot;&quot;
    Trace basic information about the provided objects.
    &quot;&quot;&quot;
    # Display where finder is looking for packages
    search_scope = finder.search_scope
    locations = search_scope.get_formatted_locations()
    if locations:
        logger.info(locations)

def _build_package_finder(
    self,
    options: Values,
    session: PipSession,
    target_python: TargetPython | None = None,
    ignore_requires_python: bool | None = None,
) -&gt; PackageFinder:
    &quot;&quot;&quot;
    Create a package finder appropriate to this requirement command.

    :param ignore_requires_python: Whether to ignore incompatible
        &quot;Requires-Python&quot; values in links. Defaults to False.
    &quot;&quot;&quot;
    link_collector = LinkCollector.create(session, options=options)
    selection_prefs = SelectionPreferences(
        allow_yanked=True,
        format_control=options.format_control,
        allow_all_prereleases=options.pre,
        prefer_binary=options.prefer_binary,
        ignore_requires_python=ignore_requires_python,
    )

    return PackageFinder.create(
        link_collector=link_collector,
        selection_prefs=selection_prefs,
        target_python=target_python,
    )
</pre></div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Adam Worsnip.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>