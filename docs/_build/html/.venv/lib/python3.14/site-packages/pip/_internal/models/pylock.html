

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>&lt;no title&gt; &mdash; Retrogue 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/custom.css?v=a6a68382" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../_static/fonts.css?v=5583d106" />

  
      <script src="../../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../../index.html" class="icon icon-home">
            Retrogue
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../index.html">Retrogue</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">&lt;no title&gt;</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../../_sources/.venv/lib/python3.14/site-packages/pip/_internal/models/pylock.py.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>from <strong>future</strong> import annotations</p>
<p>import dataclasses
import re
from collections.abc import Iterable
from dataclasses import dataclass
from pathlib import Path
from typing import TYPE_CHECKING, Any</p>
<p>from pip._vendor import tomli_w</p>
<p>from pip._internal.models.direct_url import ArchiveInfo, DirInfo, VcsInfo
from pip._internal.models.link import Link
from pip._internal.req.req_install import InstallRequirement
from pip._internal.utils.urls import url_to_path</p>
<p>if TYPE_CHECKING:
from typing_extensions import Self</p>
<p>PYLOCK_FILE_NAME_RE = re.compile(r”^pylock.(<a href="#id3"><span class="problematic" id="id1">[^.]</span></a>+).toml$”)</p>
<p>def is_valid_pylock_file_name(path: Path) -&gt; bool:
return path.name == “pylock.toml” or bool(re.match(PYLOCK_FILE_NAME_RE, path.name))</p>
<p>def <em>toml_dict_factory(data: list[tuple[str, Any]]) -&gt; dict[str, Any]:
return {key.replace(”</em>”, “-“): value for key, value in data if value is not None}</p>
<p>&#64;dataclass
class PackageVcs:
type: str
url: str | None
# (not supported) path: Optional[str]
requested_revision: str | None
commit_id: str
subdirectory: str | None</p>
<p>&#64;dataclass
class PackageDirectory:
path: str
editable: bool | None
subdirectory: str | None</p>
<p>&#64;dataclass
class PackageArchive:
url: str | None
# (not supported) path: Optional[str]
# (not supported) size: Optional[int]
# (not supported) upload_time: Optional[datetime]
hashes: dict[str, str]
subdirectory: str | None</p>
<p>&#64;dataclass
class PackageSdist:
name: str
# (not supported) upload_time: Optional[datetime]
url: str | None
# (not supported) path: Optional[str]
# (not supported) size: Optional[int]
hashes: dict[str, str]</p>
<p>&#64;dataclass
class PackageWheel:
name: str
# (not supported) upload_time: Optional[datetime]
url: str | None
# (not supported) path: Optional[str]
# (not supported) size: Optional[int]
hashes: dict[str, str]</p>
<p>&#64;dataclass
class Package:
name: str
version: str | None = None
# (not supported) marker: Optional[str]
# (not supported) requires_python: Optional[str]
# (not supported) dependencies
vcs: PackageVcs | None = None
directory: PackageDirectory | None = None
archive: PackageArchive | None = None
# (not supported) index: Optional[str]
sdist: PackageSdist | None = None
wheels: list[PackageWheel] | None = None
# (not supported) attestation_identities: Optional[List[Dict[str, Any]]]
# (not supported) tool: Optional[Dict[str, Any]]</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>@classmethod
def from_install_requirement(cls, ireq: InstallRequirement, base_dir: Path) -&gt; Self:
    base_dir = base_dir.resolve()
    dist = ireq.get_dist()
    download_info = ireq.download_info
    assert download_info
    package = cls(name=dist.canonical_name)
    if ireq.is_direct:
        if isinstance(download_info.info, VcsInfo):
            package.vcs = PackageVcs(
                type=download_info.info.vcs,
                url=download_info.url,
                requested_revision=download_info.info.requested_revision,
                commit_id=download_info.info.commit_id,
                subdirectory=download_info.subdirectory,
            )
        elif isinstance(download_info.info, DirInfo):
            package.directory = PackageDirectory(
                path=(
                    Path(url_to_path(download_info.url))
                    .resolve()
                    .relative_to(base_dir)
                    .as_posix()
                ),
                editable=(
                    download_info.info.editable
                    if download_info.info.editable
                    else None
                ),
                subdirectory=download_info.subdirectory,
            )
        elif isinstance(download_info.info, ArchiveInfo):
            if not download_info.info.hashes:
                raise NotImplementedError()
            package.archive = PackageArchive(
                url=download_info.url,
                hashes=download_info.info.hashes,
                subdirectory=download_info.subdirectory,
            )
        else:
            # should never happen
            raise NotImplementedError()
    else:
        package.version = str(dist.version)
        if isinstance(download_info.info, ArchiveInfo):
            if not download_info.info.hashes:
                raise NotImplementedError()
            link = Link(download_info.url)
            if link.is_wheel:
                package.wheels = [
                    PackageWheel(
                        name=link.filename,
                        url=download_info.url,
                        hashes=download_info.info.hashes,
                    )
                ]
            else:
                package.sdist = PackageSdist(
                    name=link.filename,
                    url=download_info.url,
                    hashes=download_info.info.hashes,
                )
        else:
            # should never happen
            raise NotImplementedError()
    return package
</pre></div>
</div>
<p>&#64;dataclass
class Pylock:
lock_version: str = “1.0”
# (not supported) environments: Optional[List[str]]
# (not supported) requires_python: Optional[str]
# (not supported) extras: List[str] = []
# (not supported) dependency_groups: List[str] = []
created_by: str = “pip”
packages: list[Package] = dataclasses.field(default_factory=list)
# (not supported) tool: Optional[Dict[str, Any]]</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>def as_toml(self) -&gt; str:
    return tomli_w.dumps(dataclasses.asdict(self, dict_factory=_toml_dict_factory))

@classmethod
def from_install_requirements(
    cls, install_requirements: Iterable[InstallRequirement], base_dir: Path
) -&gt; Self:
    return cls(
        packages=sorted(
            (
                Package.from_install_requirement(ireq, base_dir)
                for ireq in install_requirements
            ),
            key=lambda p: p.name,
        )
    )
</pre></div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Adam Worsnip.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>